<!DOCTYPE html>
<html lang="en">
  <head>
<meta charset="utf-8" />
<meta
  name="viewport"
  content="width=device-width, initial-scale=1.0, maximum-scale=1.0"
/>
<meta
  name="description"
  content="K Semantics of the Ethereum Virtual Machine (EVM)"
/>
<meta
  name="keywords"
  content="runtime, verification, rv, k, ethereum virtual machine, evm"
/>
<meta name="author" content="EVM Semantics | Runtime Verification Inc" />
<meta name="robots" content="index, follow" />

<!--favicon icon-->
<link rel="icon" type="image/png" href="../../../assets/img/favicon.ico" />

<title>KEVM: Semantics of EVM in K | Runtime Verification, Inc. </title>

<link rel="canonical" href="https://jellopaper.org/include/kframework/foundry/" />

<!--web fonts-->
<link
  href="https://fonts.googleapis.com/css?family=Nunito:300,400,600,700,800"
  rel="stylesheet"
/>
<link
  href="https://fonts.googleapis.com/css?family=Lora:400i"
  rel="stylesheet"
/>

<link
  href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.14.0/css/all.min.css"
  rel="stylesheet"
/>

<link href="../../../assets/css/index.css" rel="stylesheet" />

<!--[if (gt IE 9) |!(IE)]><!-->
<!--<link rel="stylesheet" href="/assets/vendor/custom-nav/css/effects/fade-menu.css"/>-->
<!-- <link rel="stylesheet" href="../../../assets/k/vl-nav/css/effects/slide-menu.css" /> -->
<!--<![endif]-->

  </head>

  <body>
<header
  class="navbar navbar-expand navbar-dark flex-column flex-md-row bd-navbar"
>
  <a class="logo-link" href="../../../index.html"> EVM Semantics </a>
  <ul class="navbar-nav ml-md-auto">
    <li class="nav-item">
      <a
        class="nav-link pl-2 pr-1 mx-1 py-3 my-n2"
        href="https://github.com/runtimeverification/evm-semantics"
        target="_blank"
        rel="noopener"
        aria-label="GitHub"
      >
        <i class="fab fa-github"></i>
      </a>
    </li>
  </ul>
  <!--
  <a
    class="btn btn-rv-blue d-none d-lg-inline-block mb-3 mb-md-0 ml-md-3"
    href="../../../downloads"
    >Download</a
  >
  -->
</header>


    <div class="container-fluid">
      <div class="row flex-xl-nowrap">
<div class="col-12 col-md-3 col-xl-2 bd-sidebar mb-3">
  <form
    role="search"
    class="bd-search d-flex align-items-center justify-content-between"
  >
    <input
      type="search"
      class="form-control"
      placeholder="Search..."
      aria-label="Search for..."
      autocomplete="false"
      id="search-box"
    />
    <button
      class="btn bd-search-docs-toggle d-md-none p-0 ml-3 collapsed"
      type="button"
      aria-label="Toggle docs navigation"
      style="font-size: 1.4rem"
    >
      <i class="fas fa-bars"></i>
    </button>
  </form>
  <nav class="collapse bd-links" aria-label="Main navigation">
    <div class="bd-toc-item">
      <a class="bd-toc-link" href="../../../">Homepage</a>
      <a class="bd-toc-link" href="../../../INSTALL/">Install</a>
    </div>
  </nav>
</div>

        <main
          class="col-12 col-md-6 col-xl-8 py-md-3 pl-md-5 bd-content"
          role="main"
        >
          <div class="markdown-preview"><html><head></head><body><h1 id="foundry-specifications">Foundry Specifications</h1>
<p><strong>UNDER CONSTRUCTION</strong></p>
<h2 id="example-usage">Example Usage</h2>
<p>From the root of the <a href="../../../">KEVM repository</a>, after having:</p>
<ul>
<li>Successfully built (or installed) KEVM, and</li>
<li>Have <code>kevm</code> on <code>PATH</code>, and</li>
<li>Have stepped into the virtual environment (see the <a href="../../../">README</a>).</li>
</ul>
<p>KEVM supports Foundry specifications via two CLI utilities, <code>foundry-kompile</code> and <code>foundry-prove</code>.
To get help, you can do <code>kevm foundry-kompile --help</code> and <code>kevm foundry-prove --help</code>.
Each command takes as input the Foundry <code>out/</code> directory.
For example, in the root of this repository, you can run:</p>
<p><em>Build Foundry Project:</em></p>
<pre><code class="language-sh">$ <span class="token builtin class-name">cd</span> tests/foundry
$ forge build
<span class="token punctuation">[</span>⠊<span class="token punctuation">]</span> Compiling<span class="token punctuation">..</span>.
<span class="token punctuation">[</span>⠑<span class="token punctuation">]</span> Compiling <span class="token number">44</span> files with <span class="token number">0.8</span>.13
<span class="token punctuation">[</span>⠊<span class="token punctuation">]</span> Solc <span class="token number">0.8</span>.13 finished <span class="token keyword">in</span> <span class="token number">3</span>.58s
Compiler run successful <span class="token punctuation">(</span>with warnings<span class="token punctuation">)</span>

$ <span class="token builtin class-name">cd</span> <span class="token punctuation">..</span>/<span class="token punctuation">..</span>
</code></pre>
<p><em>Kompile to KEVM specification (inside virtual environment):</em></p>
<pre><code class="language-sh">$ <span class="token function">make</span> shell
<span class="token punctuation">(</span>kevm-pyk-py3.10<span class="token punctuation">)</span> $ kevm foundry-kompile tests/foundry/out
WARNING <span class="token number">2022</span>-09-11 <span class="token number">15</span>:36:00,448 kevm_pyk.solc_to_k - Using generic <span class="token function">sort</span> K <span class="token keyword">for</span> type: uint256<span class="token punctuation">[</span><span class="token punctuation">]</span>
WARNING <span class="token number">2022</span>-09-11 <span class="token number">15</span>:36:00,448 kevm_pyk.solc_to_k - Using generic <span class="token function">sort</span> K <span class="token keyword">for</span> type: uint256<span class="token punctuation">[</span><span class="token punctuation">]</span>
WARNING <span class="token number">2022</span>-09-11 <span class="token number">15</span>:36:00,448 kevm_pyk.solc_to_k - Using generic <span class="token function">sort</span> K <span class="token keyword">for</span> type: uint256<span class="token punctuation">[</span><span class="token punctuation">]</span>
WARNING <span class="token number">2022</span>-09-11 <span class="token number">15</span>:36:00,448 kevm_pyk.solc_to_k - Using generic <span class="token function">sort</span> K <span class="token keyword">for</span> type: uint256<span class="token punctuation">[</span><span class="token punctuation">]</span>
WARNING <span class="token number">2022</span>-09-11 <span class="token number">15</span>:36:00,448 kevm_pyk.solc_to_k - Using generic <span class="token function">sort</span> K <span class="token keyword">for</span> type: uint256<span class="token punctuation">[</span><span class="token punctuation">]</span>
WARNING <span class="token number">2022</span>-09-11 <span class="token number">15</span>:36:00,448 kevm_pyk.solc_to_k - Unknown range predicate <span class="token keyword">for</span> type: uint256<span class="token punctuation">[</span><span class="token punctuation">]</span>
WARNING <span class="token number">2022</span>-09-11 <span class="token number">15</span>:36:00,448 kevm_pyk.solc_to_k - Unsupported ABI <span class="token builtin class-name">type</span> <span class="token keyword">for</span> method LoopsTest.method_LoopsTest_testMax, will not generate calldata sugar: uint256<span class="token punctuation">[</span><span class="token punctuation">]</span>
WARNING <span class="token number">2022</span>-09-11 <span class="token number">15</span>:36:00,448 kevm_pyk.solc_to_k - Using generic <span class="token function">sort</span> K <span class="token keyword">for</span> type: uint256<span class="token punctuation">[</span><span class="token punctuation">]</span>
WARNING <span class="token number">2022</span>-09-11 <span class="token number">15</span>:36:00,448 kevm_pyk.solc_to_k - Unknown range predicate <span class="token keyword">for</span> type: uint256<span class="token punctuation">[</span><span class="token punctuation">]</span>
WARNING <span class="token number">2022</span>-09-11 <span class="token number">15</span>:36:00,448 kevm_pyk.solc_to_k - Unsupported ABI <span class="token builtin class-name">type</span> <span class="token keyword">for</span> method LoopsTest.method_LoopsTest_testMaxBroken, will not generate calldata sugar: uint256<span class="token punctuation">[</span><span class="token punctuation">]</span>
WARNING <span class="token number">2022</span>-09-11 <span class="token number">15</span>:36:00,448 kevm_pyk.solc_to_k - Using generic <span class="token function">sort</span> K <span class="token keyword">for</span> type: uint256<span class="token punctuation">[</span><span class="token punctuation">]</span>
WARNING <span class="token number">2022</span>-09-11 <span class="token number">15</span>:36:00,448 kevm_pyk.solc_to_k - Unknown range predicate <span class="token keyword">for</span> type: uint256<span class="token punctuation">[</span><span class="token punctuation">]</span>
WARNING <span class="token number">2022</span>-09-11 <span class="token number">15</span>:36:00,448 kevm_pyk.solc_to_k - Unsupported ABI <span class="token builtin class-name">type</span> <span class="token keyword">for</span> method LoopsTest.method_LoopsTest_testSort, will not generate calldata sugar: uint256<span class="token punctuation">[</span><span class="token punctuation">]</span>
WARNING <span class="token number">2022</span>-09-11 <span class="token number">15</span>:36:00,448 kevm_pyk.solc_to_k - Using generic <span class="token function">sort</span> K <span class="token keyword">for</span> type: uint256<span class="token punctuation">[</span><span class="token punctuation">]</span>
WARNING <span class="token number">2022</span>-09-11 <span class="token number">15</span>:36:00,448 kevm_pyk.solc_to_k - Unknown range predicate <span class="token keyword">for</span> type: uint256<span class="token punctuation">[</span><span class="token punctuation">]</span>
WARNING <span class="token number">2022</span>-09-11 <span class="token number">15</span>:36:00,448 kevm_pyk.solc_to_k - Unsupported ABI <span class="token builtin class-name">type</span> <span class="token keyword">for</span> method LoopsTest.method_LoopsTest_testSortBroken, will not generate calldata sugar: uint256<span class="token punctuation">[</span><span class="token punctuation">]</span>
WARNING <span class="token number">2022</span>-09-11 <span class="token number">15</span>:36:00,449 kevm_pyk.solc_to_k - Using generic <span class="token function">sort</span> K <span class="token keyword">for</span> type: uint256<span class="token punctuation">[</span><span class="token punctuation">]</span>
WARNING <span class="token number">2022</span>-09-11 <span class="token number">15</span>:36:00,449 kevm_pyk.solc_to_k - Using generic <span class="token function">sort</span> K <span class="token keyword">for</span> type: uint256<span class="token punctuation">[</span><span class="token punctuation">]</span>
WARNING <span class="token number">2022</span>-09-11 <span class="token number">15</span>:36:00,449 kevm_pyk.solc_to_k - Using generic <span class="token function">sort</span> K <span class="token keyword">for</span> type: uint256<span class="token punctuation">[</span><span class="token punctuation">]</span>
WARNING <span class="token number">2022</span>-09-11 <span class="token number">15</span>:36:00,449 kevm_pyk.solc_to_k - Using generic <span class="token function">sort</span> K <span class="token keyword">for</span> type: uint256<span class="token punctuation">[</span><span class="token punctuation">]</span>
$ <span class="token builtin class-name">exit</span>
</code></pre>
<p><em>And discharge some specific test as a proof obligation (inside virtual environment):</em></p>
<pre><code class="language-sh">$ <span class="token function">make</span> shell
<span class="token punctuation">(</span>kevm-pyk-py3.10<span class="token punctuation">)</span> $ kevm foundry-prove tests/foundry/out <span class="token parameter variable">--test</span> AssertTest.test_assert_true
WARNING <span class="token number">2022</span>-09-11 <span class="token number">15</span>:37:31,956 __main__ - Ignoring command-line option: --definition: /home/dev/src/evm-semantics/.build/usr/lib/kevm/haskell
<span class="token comment">#Top</span>
$ <span class="token builtin class-name">exit</span>
</code></pre>
<h2 id="foundry-module-for-kevm">Foundry Module for KEVM</h2>
<p>Foundry's testing framework provides a series of cheatcodes so that developers can specify what situation they want to test.
This file describes the KEVM specification of the Foundry testing framework, which includes the definition of said cheatcodes and what does it mean for a test to pass.</p>
<pre><code class="language-k"><span class="token keyword">requires</span> <span class="token string">"evm.md"</span>
<span class="token keyword">requires</span> <span class="token string">"hashed-locations.md"</span>
<span class="token keyword">requires</span> <span class="token string">"abi.md"</span>
<span class="token keyword">requires</span> <span class="token string">"edsl.md"</span>
<span class="token keyword">requires</span> <span class="token string">"lemmas/lemmas.k"</span>

<span class="token keyword">module</span> FOUNDRY
    <span class="token keyword">imports</span> FOUNDRY<span class="token operator">-</span>SUCCESS
    <span class="token keyword">imports</span> FOUNDRY<span class="token operator">-</span>CHEAT<span class="token operator">-</span>CODES
    <span class="token keyword">imports</span> FOUNDRY<span class="token operator">-</span>ACCOUNTS
    <span class="token keyword">imports</span> EDSL
    <span class="token keyword">imports</span> LEMMAS

    <span class="token keyword">configuration</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>foundry</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>kevm</span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cheatcodes</span><span class="token punctuation">/&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>foundry</span><span class="token punctuation">&gt;</span></span>
<span class="token keyword">endmodule</span>
</code></pre>
<h3 id="foundry-success-predicate">Foundry Success Predicate</h3>
<p>Foundry has several baked-in convenience accounts for helping to define the "cheat-codes".
Here we define their addresses, and important storage-locations.</p>
<pre><code class="language-k"><span class="token keyword">module</span> FOUNDRY<span class="token operator">-</span>ACCOUNTS
    <span class="token keyword">imports</span> SOLIDITY<span class="token operator">-</span>FIELDS

    <span class="token keyword">syntax</span> <span class="token keyword">Int</span>             <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #address <span class="token punctuation">(</span> Contract <span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token class-name">macro</span><span class="token punctuation">]</span>
    <span class="token keyword">syntax</span> Contract        <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> FoundryContract
    <span class="token keyword">syntax</span> Field           <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> FoundryField
    <span class="token keyword">syntax</span> FoundryContract <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">"FoundryTest"</span>  <span class="token punctuation">[</span><span class="token class-name">klabel</span><span class="token punctuation">(</span>contract_FoundryTest<span class="token punctuation">)</span><span class="token punctuation">]</span>
                             <span class="token operator">|</span> <span class="token string">"FoundryCheat"</span> <span class="token punctuation">[</span><span class="token class-name">klabel</span><span class="token punctuation">(</span>contract_FoundryCheat<span class="token punctuation">)</span><span class="token punctuation">]</span>
 <span class="token comment">// -------------------------------------------------------------------------</span>
    <span class="token keyword">rule</span> #address<span class="token punctuation">(</span>FoundryTest<span class="token punctuation">)</span>  <span class="token operator">=&gt;</span> <span class="token number">1032069922050249630382865877677304880282300743300</span> <span class="token comment">// 0xb4c79daB8f259C7Aee6E5b2Aa729821864227e84</span>
    <span class="token keyword">rule</span> #address<span class="token punctuation">(</span>FoundryCheat<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token number">645326474426547203313410069153905908525362434349</span>  <span class="token comment">// 0x7109709ECfa91a80626fF3989D68f67F5b1DD12D</span>

    <span class="token keyword">syntax</span> FoundryField <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">"Failed"</span> <span class="token punctuation">[</span><span class="token class-name">klabel</span><span class="token punctuation">(</span>slot_failed<span class="token punctuation">)</span><span class="token punctuation">]</span>
 <span class="token comment">// ------------------------------------------------------</span>
    <span class="token keyword">rule</span> #loc<span class="token punctuation">(</span>FoundryCheat <span class="token punctuation">.</span> Failed<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token number">46308022326495007027972728677917914892729792999299745830475596687180801507328</span> <span class="token comment">// 0x6661696c65640000000000000000000000000000000000000000000000000000</span>

<span class="token keyword">endmodule</span>
</code></pre>
<p>The Foundry success predicate performs the same checks as <a href="https://github.com/foundry-rs/foundry/blob/e530c7325816e4256f62f4426bd9985dc54da831/evm/src/executor/mod.rs#L490" target="_blank" rel="noreferrer noopener">the <code>is_success</code> function from Foundry in <code>evm/src/executor/mod.rs</code></a>.</p>
<p>These checks are:</p>
<ul>
<li>The call to the test contract has not reverted, and</li>
<li><code>DSTest.assert*</code> have not failed.</li>
</ul>
<p>The last condition is implemented in the <a href="https://github.com/dapphub/ds-test/blob/9310e879db8ba3ea6d5c6489a579118fd264a3f5/src/test.sol#L65" target="_blank" rel="noreferrer noopener"><code>fail()</code> function from <code>DSTest</code></a>.
If a DSTest assertion should fail, the <code>fail()</code> function stores <code>bytes32(uint256(0x01))</code> at the storage slot <code>bytes32("failed")</code>.
Hence, checking if a <code>DSTest.assert*</code> has failed amounts to reading as a boolean the data from that particular storage slot.</p>
<p><strong>TODO</strong>: It should also be checked if the code present in the <code>FoundryCheat</code> account is non-empty, and return false if it is.</p>
<pre><code class="language-k"><span class="token keyword">module</span> FOUNDRY<span class="token operator">-</span>SUCCESS
    <span class="token keyword">imports</span> EVM

    <span class="token keyword">syntax</span> <span class="token keyword">Bool</span> <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">"foundry_success"</span> <span class="token string">"("</span> StatusCode <span class="token string">","</span> <span class="token keyword">Int</span> <span class="token string">","</span> <span class="token keyword">Bool</span> <span class="token string">","</span> <span class="token keyword">Bool</span> <span class="token string">","</span> <span class="token keyword">Bool</span> <span class="token string">","</span> <span class="token keyword">Bool</span> <span class="token string">")"</span> <span class="token punctuation">[</span>function<span class="token punctuation">,</span> <span class="token class-name">klabel</span><span class="token punctuation">(</span>foundry_success<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">symbol</span><span class="token punctuation">]</span>
 <span class="token comment">// --------------------------------------------------------------------------------------------------------------------------------------------</span>
    <span class="token keyword">rule</span> foundry_success<span class="token punctuation">(</span>EVMC_SUCCESS<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token boolean">true</span>
    <span class="token keyword">rule</span> foundry_success<span class="token punctuation">(</span>_<span class="token punctuation">,</span> _<span class="token punctuation">,</span> _<span class="token punctuation">,</span> _<span class="token punctuation">,</span> _<span class="token punctuation">,</span> _<span class="token punctuation">)</span>                            <span class="token operator">=&gt;</span> <span class="token boolean">false</span> <span class="token punctuation">[</span>owise<span class="token punctuation">]</span>

<span class="token keyword">endmodule</span>
</code></pre>
<h3 id="foundry-cheat-codes">Foundry Cheat Codes</h3>
<p>The configuration of the Foundry Cheat Codes is defined as follwing:</p>
<ol>
<li>The <code>&lt;prank&gt;</code> subconfiguration stores values which are used during the execution of any kind of <code>prank</code> cheat code:
<ul>
<li><code>&lt;prevCaller&gt;</code> keeps the current address of the contract that initiated the prank.</li>
<li><code>&lt;prevOrigin&gt;</code> keeps the current address of the <code>tx.origin</code> value.</li>
<li><code>&lt;newCaller&gt;</code> and <code>&lt;newOrigin&gt;</code> are addresses to be assigned after the prank call to <code>msg.sender</code> and <code>tx.origin</code>.</li>
<li><code>&lt;active&gt;</code> signals if a prank is active or not.</li>
<li><code>&lt;depth&gt;</code> records the current call depth at which the prank was invoked.</li>
<li><code>&lt;singleCall&gt;</code> tells whether the prank stops by itself after the next call or when a <code>stopPrank</code> cheat code is invoked.</li>
</ul>
</li>
<li>The <code>&lt;expectedRevert&gt;</code> subconfiguration stores values used for the <code>expectRevert</code> cheat code.
<ul>
<li><code>&lt;isRevertExpected&gt;</code> flags if the next call is expected to revert or not.</li>
<li><code>&lt;expectedDepth&gt;</code> records the depth at which the call is expected to revert.</li>
<li><code>&lt;expectedReason&gt;</code> keeps the expected revert message as a ByteArray.</li>
</ul>
</li>
<li>The <code>&lt;expectOpcode&gt;</code> subconfiguration stores values used for <code>expect*OPCODE*</code> cheat codes.
<ul>
<li><code>&lt;isOpcodeExpected&gt;</code> flags if a call opcode is expected.</li>
<li><code>&lt;expectedAddress&gt;</code> keeps the expected caller.</li>
<li><code>&lt;expectedValue&gt;</code> keeps expected <code>msg.value</code>.</li>
<li><code>&lt;expectedData&gt;</code> keeps expected <code>calldata</code>.</li>
<li><code>&lt;opcodeType&gt;</code> keeps track of what <code>CALL*</code> Opcode is expected.</li>
</ul>
</li>
<li>The <code>&lt;expectEmit&gt;</code> subconfiguration stores values used for the <code>expectEmit</code> cheat code.
<ul>
<li><code>&lt;recordEvent&gt;</code> flags if the next emitted Event should be recorded and held for future matches.</li>
<li><code>&lt;isEventExpected&gt;</code> flags if an Event is expected to match the one recorded previously.</li>
<li><code>&lt;checkedTopics&gt;</code> will store a list of <code>bool</code> values that flag if a topic should be checked or not.</li>
<li><code>&lt;checkedData&gt;</code> flags if the data field should be checked or not.</li>
<li><code>&lt;expectedEventAddress&gt;</code> stores the emitter of an expected Event.</li>
</ul>
</li>
<li>The <code>&lt;whitelist&gt;</code> subconfiguration stores addresses that can be called and storage slots that can be accessed/modified during the execution.
<ul>
<li><code>&lt;isCallWhitelistActive&gt;</code> flags if the whitelist mode is enabled for calls.</li>
<li><code>&lt;isStorageWhitelistActive&gt;</code> flags if the whitelist mode is enabled for storage changes.</li>
<li><code>&lt;addressSet&gt;</code> - stores the address whitelist.</li>
<li><code>&lt;storageSlotSet&gt;</code> - stores the storage whitelist containing pairs of addresses and storage indexes.</li>
</ul>
</li>
</ol>
<pre><code class="language-k"><span class="token keyword">module</span> FOUNDRY<span class="token operator">-</span>CHEAT<span class="token operator">-</span>CODES
    <span class="token keyword">imports</span> EVM
    <span class="token keyword">imports</span> EVM<span class="token operator">-</span>ABI
    <span class="token keyword">imports</span> FOUNDRY<span class="token operator">-</span>ACCOUNTS

    <span class="token keyword">configuration</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cheatcodes</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>prank</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>prevCaller</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">.</span>Account <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>prevCaller</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>prevOrigin</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">.</span>Account <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>prevOrigin</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>newCaller</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">.</span>Account <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>newCaller</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>newOrigin</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">.</span>Account <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>newOrigin</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>active</span><span class="token punctuation">&gt;</span></span> <span class="token boolean">false</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>active</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>depth</span><span class="token punctuation">&gt;</span></span> <span class="token number">0</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>depth</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>singleCall</span><span class="token punctuation">&gt;</span></span> <span class="token boolean">false</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>singleCall</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>prank</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>expectedRevert</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>isRevertExpected</span><span class="token punctuation">&gt;</span></span> <span class="token boolean">false</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>isRevertExpected</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>expectedReason</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">.</span>ByteArray <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>expectedReason</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>expectedDepth</span><span class="token punctuation">&gt;</span></span> <span class="token number">0</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>expectedDepth</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>expectedRevert</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>expectedOpcode</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>isOpcodeExpected</span><span class="token punctuation">&gt;</span></span> <span class="token boolean">false</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>isOpcodeExpected</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>expectedAddress</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">.</span>Account <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>expectedAddress</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>expectedValue</span><span class="token punctuation">&gt;</span></span> <span class="token number">0</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>expectedValue</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>expectedData</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">.</span>ByteArray <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>expectedData</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>opcodeType</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">.</span>OpcodeType <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>opcodeType</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>expectedOpcode</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>expectEmit</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>recordEvent</span><span class="token punctuation">&gt;</span></span> <span class="token boolean">false</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>recordEvent</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>isEventExpected</span><span class="token punctuation">&gt;</span></span> <span class="token boolean">false</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>isEventExpected</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>checkedTopics</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">.</span>List <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>checkedTopics</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>checkedData</span><span class="token punctuation">&gt;</span></span> <span class="token boolean">false</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>checkedData</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>expectedEventAddress</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">.</span>Account <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>expectedEventAddress</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>expectEmit</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>whitelist</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>isCallWhitelistActive</span><span class="token punctuation">&gt;</span></span> <span class="token boolean">false</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>isCallWhitelistActive</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>isStorageWhitelistActive</span><span class="token punctuation">&gt;</span></span> <span class="token boolean">false</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>isStorageWhitelistActive</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>addressSet</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">.</span>Set <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>addressSet</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>storageSlotSet</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">.</span>Set <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>storageSlotSet</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>whitelist</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>cheatcodes</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<p>First we have some helpers in K which can:</p>
<ul>
<li>Inject a given boolean condition into's this execution's path condition</li>
<li>Set the <code>FoundryCheat . Failed</code> location to <code>True</code>.</li>
</ul>
<pre><code class="language-k">    <span class="token keyword">syntax</span> KItem <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #assume <span class="token punctuation">(</span> <span class="token keyword">Bool</span> <span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token class-name">klabel</span><span class="token punctuation">(</span>foundry_assume<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">symbol</span><span class="token punctuation">]</span>
 <span class="token comment">// ------------------------------------------------------------------</span>
    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #assume<span class="token punctuation">(</span>B<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span> ensures B

     <span class="token keyword">syntax</span> KItem <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">"#markAsFailed"</span> <span class="token punctuation">[</span><span class="token class-name">klabel</span><span class="token punctuation">(</span>foundry_markAsFailed<span class="token punctuation">)</span><span class="token punctuation">]</span>
  <span class="token comment">// ---------------------------------------------------------------</span>
     <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #markAsFailed <span class="token operator">=&gt;</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>account</span><span class="token punctuation">&gt;</span></span>
             <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>acctID</span><span class="token punctuation">&gt;</span></span> #address<span class="token punctuation">(</span>FoundryCheat<span class="token punctuation">)</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>acctID</span><span class="token punctuation">&gt;</span></span>
             <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>storage</span><span class="token punctuation">&gt;</span></span> STORAGE <span class="token operator">=&gt;</span> STORAGE <span class="token punctuation">[</span> #loc<span class="token punctuation">(</span>FoundryCheat <span class="token punctuation">.</span> Failed<span class="token punctuation">)</span> &lt;<span class="token operator">-</span> <span class="token number">1</span> <span class="token punctuation">]</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>storage</span><span class="token punctuation">&gt;</span></span>
             <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>account</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<h4 id="structure-of-execution">Structure of execution</h4>
<p>The <code>foundry.call</code> rule is used to inject specific behaviour for each cheat code.
The rule has a higher priority than any other <code>#call</code> rule and will match every call made to the <a href="https://book.getfoundry.sh/cheatcodes/#cheatcodes-reference" target="_blank" rel="noreferrer noopener">Foundry cheatcode address</a>.
The function selector, represented as <code>#asWord(#range(ARGS, 0, 4))</code> and the call data <code>#range(ARGS, 4, #sizeByteArray(ARGS) -Int 4)</code> are passed to the <code>#call_foundry</code> production, which will further rewrite using rules defined for implemented cheat codes.
Finally, the rule for <code>#return_foundry</code> is used to end the execution of the <code>CALL</code> OpCode.</p>
<pre><code class="language-k">    <span class="token keyword">rule</span> <span class="token punctuation">[</span>foundry<span class="token punctuation">.</span>call<span class="token punctuation">]</span><span class="token punctuation">:</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">(</span>#checkCall _ _
          <span class="token operator">~&gt;</span> #call _ CHEAT_ADDR _ _ _ ARGS _
          <span class="token operator">~&gt;</span> #return RETSTART RETWIDTH <span class="token punctuation">)</span>
          <span class="token operator">=&gt;</span> #call_foundry #asWord<span class="token punctuation">(</span>#range<span class="token punctuation">(</span>ARGS<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span> #range<span class="token punctuation">(</span>ARGS<span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> #sizeByteArray<span class="token punctuation">(</span>ARGS<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token keyword">Int</span> <span class="token number">4</span><span class="token punctuation">)</span>
          <span class="token operator">~&gt;</span> #return_foundry RETSTART RETWIDTH
         <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>output</span><span class="token punctuation">&gt;</span></span> _ <span class="token operator">=&gt;</span> <span class="token punctuation">.</span>ByteArray <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>output</span><span class="token punctuation">&gt;</span></span>
    <span class="token keyword">requires</span> CHEAT_ADDR <span class="token operator">==</span><span class="token keyword">Int</span> #address<span class="token punctuation">(</span>FoundryCheat<span class="token punctuation">)</span>
    <span class="token punctuation">[</span>priority<span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
</code></pre>
<p>We define two productions named <code>#return_foundry</code> and <code>#call_foundry</code>, which will be used by each cheat code.
The rule <code>foundry.return</code> will rewrite the <code>#return_foundry</code> production into other productions that will place the output of the execution into the local memory, refund the gas value of the call and push the value <code>1</code> on the call stack.</p>
<pre><code class="language-k">    <span class="token keyword">syntax</span> KItem <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">"#return_foundry"</span> <span class="token keyword">Int</span> <span class="token keyword">Int</span>       <span class="token punctuation">[</span><span class="token class-name">klabel</span><span class="token punctuation">(</span>foundry_return<span class="token punctuation">)</span><span class="token punctuation">]</span>
                   <span class="token operator">|</span> <span class="token string">"#call_foundry"</span> <span class="token keyword">Int</span> ByteArray     <span class="token punctuation">[</span><span class="token class-name">klabel</span><span class="token punctuation">(</span>foundry_call<span class="token punctuation">)</span><span class="token punctuation">]</span>
                   <span class="token operator">|</span> <span class="token string">"#error_foundry"</span> <span class="token keyword">Int</span> ByteArray   <span class="token punctuation">[</span><span class="token class-name">klabel</span><span class="token punctuation">(</span>foundry_error<span class="token punctuation">)</span><span class="token punctuation">]</span>
 <span class="token comment">// -------------------------------------------------------------------------</span>
    <span class="token keyword">rule</span> <span class="token punctuation">[</span>foundry<span class="token punctuation">.</span>return<span class="token punctuation">]</span><span class="token punctuation">:</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #return_foundry RETSTART RETWIDTH
          <span class="token operator">=&gt;</span> #setLocalMem RETSTART RETWIDTH OUT
          <span class="token operator">~&gt;</span> #refund GCALL
          <span class="token operator">~&gt;</span> <span class="token number">1</span> <span class="token operator">~&gt;</span> #push
          <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>output</span><span class="token punctuation">&gt;</span></span> OUT <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>output</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>callGas</span><span class="token punctuation">&gt;</span></span> GCALL <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>callGas</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<p>We define a new status codes:</p>
<ul>
<li><code>FOUNDRY_UNIMPLEMENTED</code>, which signals that the execution ran into an unimplemented cheat code.</li>
<li><code>FOUNDRY_WHITELISTCALL</code>, which signals that an address outside the whitelist has been called during the execution.</li>
<li><code>FOUNDRY_WHITELISTSTORAGE</code>, which signals that a storage index of an address outside the whitelist has been changed during the execution.</li>
</ul>
<pre><code class="language-k">    <span class="token keyword">syntax</span> ExceptionalStatusCode <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">"FOUNDRY_UNIMPLEMENTED"</span>
                                   <span class="token operator">|</span> <span class="token string">"FOUNDRY_WHITELISTCALL"</span>
                                   <span class="token operator">|</span> <span class="token string">"FOUNDRY_WHITELISTSTORAGE"</span>
 <span class="token comment">// -----------------------------------------------------------</span>
</code></pre>
<p>Below, we define rules for the <code>#call_foundry</code> production, handling the cheat codes.</p>
<h4 id="assume---insert-a-condition"><code>assume</code> - Insert a condition</h4>
<pre><code>function assume(bool) external;
</code></pre>
<p><code>foundry.call.assume</code> will match when the <code>assume</code> cheat code function is called.
This rule then takes a <code>bool</code> condition from the function call data, represented using the <code>ARGS</code> variable, and injects it into the execution path using the <code>#assume</code> production.
<code>==K #bufStrict(32, 1)</code> is used to mark that the condition should hold.</p>
<pre><code class="language-k">    <span class="token keyword">rule</span> <span class="token punctuation">[</span>foundry<span class="token punctuation">.</span>call<span class="token punctuation">.</span>assume<span class="token punctuation">]</span><span class="token punctuation">:</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #call_foundry SELECTOR ARGS <span class="token operator">=&gt;</span> #assume<span class="token punctuation">(</span>ARGS <span class="token operator">==</span>K #bufStrict<span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
      <span class="token keyword">requires</span> SELECTOR <span class="token operator">==</span><span class="token keyword">Int</span> selector <span class="token punctuation">(</span> <span class="token string">"assume(bool)"</span> <span class="token punctuation">)</span>
</code></pre>
<h4 id="deal---set-a-given-balance-to-a-given-account."><code>deal</code> - Set a given balance to a given account.</h4>
<pre><code>function deal(address who, uint256 newBalance) external;
</code></pre>
<p><code>foundry.call.deal</code> will match when the <code>deal</code> cheat code function is called.
The rule then takes from the function call data the target account, using <code>#asWord(#range(ARGS, 0, 32)</code>, and the new balance, using <code>#asWord(#range(ARGS, 32, 32))</code>, and forwards them to the <code>#setBalance</code> production which updates the account accordingly.</p>
<pre><code class="language-k">    <span class="token keyword">rule</span> <span class="token punctuation">[</span>foundry<span class="token punctuation">.</span>call<span class="token punctuation">.</span>deal<span class="token punctuation">]</span><span class="token punctuation">:</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #call_foundry SELECTOR ARGS <span class="token operator">=&gt;</span> #loadAccount #asWord<span class="token punctuation">(</span>#range<span class="token punctuation">(</span>ARGS<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">~&gt;</span> #setBalance #asWord<span class="token punctuation">(</span>#range<span class="token punctuation">(</span>ARGS<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">)</span> #asWord<span class="token punctuation">(</span>#range<span class="token punctuation">(</span>ARGS<span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
      <span class="token keyword">requires</span> SELECTOR <span class="token operator">==</span><span class="token keyword">Int</span> selector <span class="token punctuation">(</span> <span class="token string">"deal(address,uint256)"</span> <span class="token punctuation">)</span>
</code></pre>
<h4 id="etch---sets-the-code-of-an-account."><code>etch</code> - Sets the code of an account.</h4>
<pre><code>function etch(address who, bytes calldata code) external;
</code></pre>
<p><code>foundry.call.etch</code> will match when the <code>etch</code> cheat code function is called.
This rule then takes from the function call data the target account, using <code>#asWord(#range(ARGS, 0, 32)</code>, and the new bytecode, using <code>#range(ARGS, CODE_START, CODE_LENGTH)</code>, where <code>#asWord(#range(ARGS, 64, 32))</code> is used to determine the length of the second argument.
The values are forwarded to the <code>#setCode</code> production which updates the account accordingly.</p>
<pre><code class="language-k">    <span class="token keyword">rule</span> <span class="token punctuation">[</span>foundry<span class="token punctuation">.</span>call<span class="token punctuation">.</span>etch<span class="token punctuation">]</span><span class="token punctuation">:</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #call_foundry SELECTOR ARGS
          <span class="token operator">=&gt;</span> #loadAccount #asWord<span class="token punctuation">(</span>#range<span class="token punctuation">(</span>ARGS<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
          <span class="token operator">~&gt;</span> #let CODE_START <span class="token operator">=</span> <span class="token number">96</span> #in
             #let CODE_LENGTH <span class="token operator">=</span> #asWord<span class="token punctuation">(</span>#range<span class="token punctuation">(</span>ARGS<span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">)</span> #in
             #setCode #asWord<span class="token punctuation">(</span>#range<span class="token punctuation">(</span>ARGS<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">)</span> #range<span class="token punctuation">(</span>ARGS<span class="token punctuation">,</span> CODE_START<span class="token punctuation">,</span> CODE_LENGTH<span class="token punctuation">)</span>
         <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
      <span class="token keyword">requires</span> SELECTOR <span class="token operator">==</span><span class="token keyword">Int</span> selector <span class="token punctuation">(</span> <span class="token string">"etch(address,bytes)"</span> <span class="token punctuation">)</span>
</code></pre>
<h4 id="warp---sets-the-block-timestamp."><code>warp</code> - Sets the block timestamp.</h4>
<pre><code>function warp(uint256) external;
</code></pre>
<p><code>foundry.call.warp</code> will match when the <code>warp</code> cheat code function is called.
This rule then takes the <code>uint256</code> value from the function call data which is represented as <code>ARGS</code> and updates the <code>&lt;timestamp&gt;</code> cell.</p>
<pre><code class="language-k">    <span class="token keyword">rule</span> <span class="token punctuation">[</span>foundry<span class="token punctuation">.</span>call<span class="token punctuation">.</span>warp<span class="token punctuation">]</span><span class="token punctuation">:</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #call_foundry SELECTOR ARGS <span class="token operator">=&gt;</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>timestamp</span><span class="token punctuation">&gt;</span></span> _ <span class="token operator">=&gt;</span> #asWord<span class="token punctuation">(</span>ARGS<span class="token punctuation">)</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>timestamp</span><span class="token punctuation">&gt;</span></span>
      <span class="token keyword">requires</span> SELECTOR <span class="token operator">==</span><span class="token keyword">Int</span> selector<span class="token punctuation">(</span> <span class="token string">"warp(uint256)"</span> <span class="token punctuation">)</span>
</code></pre>
<h4 id="roll---sets-the-block-number."><code>roll</code> - Sets the block number.</h4>
<pre><code>function roll(uint256) external;
</code></pre>
<p><code>foundry.call.roll</code> will match when the <code>roll</code> cheat code function is called.
This rule then takes the <code>uint256</code> value from the function call data which is represented as <code>ARGS</code> and updates the <code>&lt;number&gt;</code> cell.</p>
<pre><code class="language-k">    <span class="token keyword">rule</span> <span class="token punctuation">[</span>foundry<span class="token punctuation">.</span>call<span class="token punctuation">.</span>roll<span class="token punctuation">]</span><span class="token punctuation">:</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #call_foundry SELECTOR ARGS <span class="token operator">=&gt;</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>number</span><span class="token punctuation">&gt;</span></span> _ <span class="token operator">=&gt;</span> #asWord<span class="token punctuation">(</span>ARGS<span class="token punctuation">)</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>number</span><span class="token punctuation">&gt;</span></span>
      <span class="token keyword">requires</span> SELECTOR <span class="token operator">==</span><span class="token keyword">Int</span> selector <span class="token punctuation">(</span> <span class="token string">"roll(uint256)"</span> <span class="token punctuation">)</span>
</code></pre>
<h4 id="fee---sets-the-block-base-fee."><code>fee</code> - Sets the block base fee.</h4>
<pre><code>function fee(uint256) external;
</code></pre>
<p><code>foundry.call.fee</code> will match when the <code>fee</code> cheat code function is called.
This rule then takes the <code>uint256</code> value from the function call data which is represented as <code>ARGS</code> and updates the <code>&lt;baseFee&gt;</code> cell.</p>
<pre><code class="language-k">    <span class="token keyword">rule</span> <span class="token punctuation">[</span>foundry<span class="token punctuation">.</span>call<span class="token punctuation">.</span>fee<span class="token punctuation">]</span><span class="token punctuation">:</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #call_foundry SELECTOR ARGS <span class="token operator">=&gt;</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>baseFee</span><span class="token punctuation">&gt;</span></span> _ <span class="token operator">=&gt;</span> #asWord<span class="token punctuation">(</span>ARGS<span class="token punctuation">)</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>baseFee</span><span class="token punctuation">&gt;</span></span>
      <span class="token keyword">requires</span> SELECTOR <span class="token operator">==</span><span class="token keyword">Int</span> selector <span class="token punctuation">(</span> <span class="token string">"fee(uint256)"</span> <span class="token punctuation">)</span>
</code></pre>
<h4 id="chainid---sets-the-chain-id."><code>chainId</code> - Sets the chain ID.</h4>
<pre><code>function chainId(uint256) external;
</code></pre>
<p><code>foundry.call.chainId</code> will match when the <code>chainId</code> cheat code function is called.
This rule then takes the <code>uint256</code> value from the function call data which is represented as <code>ARGS</code> and updates the <code>&lt;chainID&gt;</code> cell.</p>
<pre><code class="language-k">    <span class="token keyword">rule</span> <span class="token punctuation">[</span>foundry<span class="token punctuation">.</span>call<span class="token punctuation">.</span>chainId<span class="token punctuation">]</span><span class="token punctuation">:</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #call_foundry SELECTOR ARGS <span class="token operator">=&gt;</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>chainID</span><span class="token punctuation">&gt;</span></span> _ <span class="token operator">=&gt;</span> #asWord<span class="token punctuation">(</span>ARGS<span class="token punctuation">)</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>chainID</span><span class="token punctuation">&gt;</span></span>
      <span class="token keyword">requires</span> SELECTOR <span class="token operator">==</span><span class="token keyword">Int</span> selector <span class="token punctuation">(</span> <span class="token string">"chainId(uint256)"</span> <span class="token punctuation">)</span>
</code></pre>
<h4 id="coinbase---sets-the-block-coinbase."><code>coinbase</code> - Sets the block coinbase.</h4>
<pre><code>function coinbase(address) external;
</code></pre>
<p><code>foundry.call.coinbase</code> will match when the <code>coinbase</code> cheat code function is called.
This rule then takes the <code>uint256</code> value from the function call data which is represented as <code>ARGS</code> and updates the <code>&lt;coinbase&gt;</code> cell.</p>
<pre><code class="language-k">    <span class="token keyword">rule</span> <span class="token punctuation">[</span>foundry<span class="token punctuation">.</span>call<span class="token punctuation">.</span>coinbase<span class="token punctuation">]</span><span class="token punctuation">:</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #call_foundry SELECTOR ARGS <span class="token operator">=&gt;</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>coinbase</span><span class="token punctuation">&gt;</span></span> _ <span class="token operator">=&gt;</span> #asWord<span class="token punctuation">(</span>ARGS<span class="token punctuation">)</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>coinbase</span><span class="token punctuation">&gt;</span></span>
      <span class="token keyword">requires</span> SELECTOR <span class="token operator">==</span><span class="token keyword">Int</span> selector <span class="token punctuation">(</span> <span class="token string">"coinbase(address)"</span> <span class="token punctuation">)</span>
</code></pre>
<h4 id="label---sets-a-label-for-a-given-address."><code>label</code> - Sets a label for a given address.</h4>
<pre><code>function label(address addr, string calldata label) external;
</code></pre>
<p><code>foundry.call.label</code> will match when the <code>label</code> cheat code function is called.
If an address is labelled, the label will show up in test traces instead of the address.
However, there is no change on the state and therefore this rule just skips the cheatcode invocation.</p>
<pre><code class="language-k">    <span class="token keyword">rule</span> <span class="token punctuation">[</span>foundry<span class="token punctuation">.</span>call<span class="token punctuation">.</span>label<span class="token punctuation">]</span><span class="token punctuation">:</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #call_foundry SELECTOR _ARGS <span class="token operator">=&gt;</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
      <span class="token keyword">requires</span> SELECTOR <span class="token operator">==</span><span class="token keyword">Int</span> selector <span class="token punctuation">(</span> <span class="token string">"label(address,string)"</span> <span class="token punctuation">)</span>
</code></pre>
<h4 id="getnonce---gets-the-nonce-of-the-given-account."><code>getNonce</code> - Gets the nonce of the given account.</h4>
<pre><code>function getNonce(address account) external returns (uint64);
</code></pre>
<p><code>foundry.call.getNonce</code> will match when the <code>getNonce</code> cheat code function is called.
This rule takes the <code>address</code> value from the function call data, which is represented as <code>ARGS</code>, and forwards it to the <code>#returnNonce</code> production, which will update the <code>&lt;output&gt;</code> cell with the <code>nonce</code> of the account.</p>
<pre><code class="language-k">    <span class="token keyword">rule</span> <span class="token punctuation">[</span>foundry<span class="token punctuation">.</span>call<span class="token punctuation">.</span>getNonce<span class="token punctuation">]</span><span class="token punctuation">:</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #call_foundry SELECTOR ARGS <span class="token operator">=&gt;</span> #loadAccount #asWord<span class="token punctuation">(</span>ARGS<span class="token punctuation">)</span> <span class="token operator">~&gt;</span> #returnNonce #asWord<span class="token punctuation">(</span>ARGS<span class="token punctuation">)</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
      <span class="token keyword">requires</span> SELECTOR <span class="token operator">==</span><span class="token keyword">Int</span> selector <span class="token punctuation">(</span> <span class="token string">"getNonce(address)"</span> <span class="token punctuation">)</span>
</code></pre>
<h4 id="setnonce---sets-the-nonce-of-the-given-account."><code>setNonce</code> - Sets the nonce of the given account.</h4>
<pre><code>function setNonce(address account, uint64 nonce) external;
</code></pre>
<p><code>foundry.call.setNonce</code> will match when the <code>setNonce</code> function is called.
This rule takes the <code>address</code> value and <code>uint64</code> value corresponding to new nonce using from the function call data, which is represented as <code>ARGS</code> forwards it to the <code>#setNonce</code> production, which will update the nonce of the account.</p>
<pre><code class="language-k">    <span class="token keyword">rule</span> <span class="token punctuation">[</span>foundry<span class="token punctuation">.</span>call<span class="token punctuation">.</span>setNonce<span class="token punctuation">]</span><span class="token punctuation">:</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #call_foundry SELECTOR ARGS <span class="token operator">=&gt;</span> #loadAccount #asWord<span class="token punctuation">(</span>#range<span class="token punctuation">(</span>ARGS<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">~&gt;</span> #setNonce #asWord<span class="token punctuation">(</span>#range<span class="token punctuation">(</span>ARGS<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">)</span> #asWord<span class="token punctuation">(</span>#range<span class="token punctuation">(</span>ARGS<span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
      <span class="token keyword">requires</span> SELECTOR <span class="token operator">==</span><span class="token keyword">Int</span> selector <span class="token punctuation">(</span> <span class="token string">"setNonce(address,uint64)"</span> <span class="token punctuation">)</span>
</code></pre>
<h4 id="addr---computes-the-address-for-a-given-private-key."><code>addr</code> - Computes the address for a given private key.</h4>
<pre><code>function addr(uint256 privateKey) external returns (address);
</code></pre>
<p><code>foundry.call.addr</code> will match when the <code>addr</code> cheat code function is called.
This rule takes <code>uint256</code> private key from the function call data, which is represented as <code>ARGS</code>, and computes the address.
The <code>&lt;output&gt;</code> cell will be updated with the value of the address generated from the private key using <code>#addrFromPrivateKey(#unparseByteStack(ARGS))</code>.
<code>#bufStrict</code> is used to pad the value to a length of 32.</p>
<pre><code class="language-k">    <span class="token keyword">rule</span> <span class="token punctuation">[</span>foundry<span class="token punctuation">.</span>call<span class="token punctuation">.</span>addr<span class="token punctuation">]</span><span class="token punctuation">:</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #call_foundry SELECTOR ARGS <span class="token operator">=&gt;</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>output</span><span class="token punctuation">&gt;</span></span> _ <span class="token operator">=&gt;</span> #bufStrict<span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">,</span> #addrFromPrivateKey<span class="token punctuation">(</span>#unparseByteStack<span class="token punctuation">(</span>ARGS<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>output</span><span class="token punctuation">&gt;</span></span>
      <span class="token keyword">requires</span> SELECTOR <span class="token operator">==</span><span class="token keyword">Int</span> selector <span class="token punctuation">(</span> <span class="token string">"addr(uint256)"</span> <span class="token punctuation">)</span>
</code></pre>
<h4 id="load---loads-a-storage-slot-from-an-address."><code>load</code> - Loads a storage slot from an address.</h4>
<pre><code>function load(address account, bytes32 slot) external returns (bytes32);
</code></pre>
<p><code>foundry.call.load</code> will match when the <code>load</code> cheat code function is called.
This rule loads the storage slot identified by <code>#asWord(#range(ARGS, 32, 32))</code> (referring to <code>slot</code> argument) from account <code>#asWord(#range(ARGS, 0, 32))</code> (referring to <code>account</code>).
The value of the identified storage slot is placed in the <code>&lt;output&gt;</code> cell using the <code>#returnStorage</code> production.</p>
<pre><code class="language-k">    <span class="token keyword">rule</span> <span class="token punctuation">[</span>foundry<span class="token punctuation">.</span>call<span class="token punctuation">.</span>load<span class="token punctuation">]</span><span class="token punctuation">:</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #call_foundry SELECTOR ARGS <span class="token operator">=&gt;</span> #loadAccount #asWord<span class="token punctuation">(</span>#range<span class="token punctuation">(</span>ARGS<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">~&gt;</span> #returnStorage #asWord<span class="token punctuation">(</span>#range<span class="token punctuation">(</span>ARGS<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">)</span> #asWord<span class="token punctuation">(</span>#range<span class="token punctuation">(</span>ARGS<span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
      <span class="token keyword">requires</span> SELECTOR <span class="token operator">==</span><span class="token keyword">Int</span> selector <span class="token punctuation">(</span> <span class="token string">"load(address,bytes32)"</span> <span class="token punctuation">)</span>
</code></pre>
<h4 id="store---stores-a-value-to-an-address'-storage-slot."><code>store</code> - Stores a value to an address' storage slot.</h4>
<pre><code>function store(address account, bytes32 slot, bytes32 value) external;
</code></pre>
<p><code>foundry.call.store</code> will match when the <code>store</code> cheat code function is called.
This rule then takes from the function call data the account using <code>#asWord(#range(ARGS, 0, 32))</code> and the new slot value using <code>#asWord(#range(ARGS, 32, 32))</code> and updates the slot denoted by <code>#asWord(#range(ARGS, 64, 32))</code>.</p>
<pre><code class="language-k">    <span class="token keyword">rule</span> <span class="token punctuation">[</span>foundry<span class="token punctuation">.</span>call<span class="token punctuation">.</span>store<span class="token punctuation">]</span><span class="token punctuation">:</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #call_foundry SELECTOR ARGS <span class="token operator">=&gt;</span> #loadAccount #asWord<span class="token punctuation">(</span>#range<span class="token punctuation">(</span>ARGS<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">~&gt;</span> #setStorage #asWord<span class="token punctuation">(</span>#range<span class="token punctuation">(</span>ARGS<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">)</span> #asWord<span class="token punctuation">(</span>#range<span class="token punctuation">(</span>ARGS<span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">)</span> #asWord<span class="token punctuation">(</span>#range<span class="token punctuation">(</span>ARGS<span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
      <span class="token keyword">requires</span> SELECTOR <span class="token operator">==</span><span class="token keyword">Int</span> selector <span class="token punctuation">(</span> <span class="token string">"store(address,bytes32,bytes32)"</span> <span class="token punctuation">)</span>
</code></pre>
<h4 id="symbolicstorage---makes-the-storage-of-the-given-address-completely-symbolic."><code>symbolicStorage</code> - Makes the storage of the given address completely symbolic.</h4>
<pre><code>function symbolicStorage(address) external;
</code></pre>
<p><code>foundry.call.symbolicStorage</code> will match when the <code>symbolicStorage</code> cheat code function is called.
This rule then takes the address using <code>#asWord(#range(ARGS, 0, 32))</code> and makes its storage completely symbolic.</p>
<pre><code class="language-k">    <span class="token keyword">rule</span> <span class="token punctuation">[</span>foundry<span class="token punctuation">.</span>call<span class="token punctuation">.</span>symbolicStorage<span class="token punctuation">]</span><span class="token punctuation">:</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #call_foundry SELECTOR ARGS <span class="token operator">=&gt;</span> #loadAccount #asWord<span class="token punctuation">(</span>ARGS<span class="token punctuation">)</span> <span class="token operator">~&gt;</span> #setSymbolicStorage #asWord<span class="token punctuation">(</span>ARGS<span class="token punctuation">)</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
      <span class="token keyword">requires</span> SELECTOR <span class="token operator">==</span><span class="token keyword">Int</span> selector <span class="token punctuation">(</span> <span class="token string">"symbolicStorage(address)"</span> <span class="token punctuation">)</span>
</code></pre>
<h2 id="expecting-the-next-call-to-revert">Expecting the next call to revert</h2>
<pre><code>function expectRevert() external;
function expectRevert(bytes4 msg) external;
function expectRevert(bytes calldata msg) external;
</code></pre>
<p>All cheat code calls which take place while <code>expectRevert</code> is active are ignored.</p>
<pre><code class="language-k">    <span class="token keyword">rule</span> <span class="token punctuation">[</span>foundry<span class="token punctuation">.</span>call<span class="token punctuation">.</span>ignoreCalls<span class="token punctuation">]</span><span class="token punctuation">:</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #call_foundry _ _ <span class="token operator">=&gt;</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>expectedRevert</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>isRevertExpected</span><span class="token punctuation">&gt;</span></span> <span class="token boolean">true</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>isRevertExpected</span><span class="token punctuation">&gt;</span></span>
           <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>expectedRevert</span><span class="token punctuation">&gt;</span></span>
      <span class="token punctuation">[</span>priority<span class="token punctuation">(</span><span class="token number">35</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
</code></pre>
<p>The <code>#halt</code> production is used to examine the end of each call in KEVM.
If the call depth of the current call is lower than the call depth of the <code>expectRevert</code> cheat code and the <code>&lt;statusCode&gt;</code> is not <code>EVMC_SUCCESS</code>, the <code>#checkRevertReason</code> will be used to compare the output of the call with the expect reason provided.</p>
<pre><code class="language-k">    <span class="token keyword">rule</span> <span class="token punctuation">[</span>foundry<span class="token punctuation">.</span>handleExpectRevert<span class="token punctuation">]</span><span class="token punctuation">:</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">(</span><span class="token punctuation">.</span> <span class="token operator">=&gt;</span> #checkRevertReason <span class="token operator">~&gt;</span> #clearExpectRevert<span class="token punctuation">)</span> <span class="token operator">~&gt;</span> #halt <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>statusCode</span><span class="token punctuation">&gt;</span></span> SC <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>statusCode</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>callDepth</span><span class="token punctuation">&gt;</span></span> CD <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>callDepth</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>expectedRevert</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>isRevertExpected</span><span class="token punctuation">&gt;</span></span> <span class="token boolean">true</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>isRevertExpected</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>expectedDepth</span><span class="token punctuation">&gt;</span></span> ED <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>expectedDepth</span><span class="token punctuation">&gt;</span></span> 
           <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>expectedRevert</span><span class="token punctuation">&gt;</span></span>
      <span class="token keyword">requires</span> CD <span class="token operator">&lt;=</span><span class="token keyword">Int</span> ED
       andBool SC <span class="token operator">=</span><span class="token operator">/</span><span class="token operator">=</span>K EVMC_SUCCESS
      <span class="token punctuation">[</span>priority<span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
</code></pre>
<p>If the call is successful, a revert is triggered and the <code>FAILED</code> location of the <code>Foundry</code> contract is set to <code>true</code> using <code>#markAsFailed</code>.</p>
<pre><code class="language-k">    <span class="token keyword">rule</span> <span class="token punctuation">[</span>foundry<span class="token punctuation">.</span>handleExpectRevert<span class="token punctuation">.</span>error<span class="token punctuation">]</span><span class="token punctuation">:</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">(</span><span class="token punctuation">.</span> <span class="token operator">=&gt;</span> #markAsFailed <span class="token operator">~&gt;</span> #clearExpectRevert<span class="token punctuation">)</span> <span class="token operator">~&gt;</span> #halt <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>statusCode</span><span class="token punctuation">&gt;</span></span> EVMC_SUCCESS <span class="token operator">=&gt;</span> EVMC_REVERT <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>statusCode</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>callDepth</span><span class="token punctuation">&gt;</span></span> CD <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>callDepth</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>expectedRevert</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>isRevertExpected</span><span class="token punctuation">&gt;</span></span> <span class="token boolean">true</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>isRevertExpected</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>expectedDepth</span><span class="token punctuation">&gt;</span></span> ED <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>expectedDepth</span><span class="token punctuation">&gt;</span></span> 
           <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>expectedRevert</span><span class="token punctuation">&gt;</span></span>
      <span class="token keyword">requires</span> CD <span class="token operator">&lt;=</span><span class="token keyword">Int</span> ED
      <span class="token punctuation">[</span>priority<span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
</code></pre>
<p>If the <code>expectRevert()</code> selector is matched, call the <code>#setExpectRevert</code> production to initialize the <code>&lt;expectedRevert&gt;</code> subconfiguration.</p>
<pre><code class="language-k">    <span class="token keyword">rule</span> <span class="token punctuation">[</span>foundry<span class="token punctuation">.</span>call<span class="token punctuation">.</span>expectRevert<span class="token punctuation">]</span><span class="token punctuation">:</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #call_foundry SELECTOR ARGS <span class="token operator">=&gt;</span> #setExpectRevert ARGS <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
      <span class="token keyword">requires</span> SELECTOR <span class="token operator">==</span><span class="token keyword">Int</span> selector <span class="token punctuation">(</span> <span class="token string">"expectRevert()"</span> <span class="token punctuation">)</span>
        orBool SELECTOR <span class="token operator">==</span><span class="token keyword">Int</span> selector <span class="token punctuation">(</span> <span class="token string">"expectRevert(bytes)"</span> <span class="token punctuation">)</span>
</code></pre>
<h2 id="expecting-a-specific-call%2Fcreate-opcode">Expecting a specific CALL/CREATE opcode</h2>
<p>First we define a sort to identify expected opcodes.</p>
<pre><code class="language-k">    <span class="token keyword">syntax</span> OpcodeType <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">".OpcodeType"</span> <span class="token operator">|</span> <span class="token string">"Call"</span> <span class="token operator">|</span> <span class="token string">"Static"</span> <span class="token operator">|</span> <span class="token string">"Delegate"</span> <span class="token operator">|</span> <span class="token string">"Create"</span> <span class="token operator">|</span> <span class="token string">"Create2"</span>
</code></pre>
<p>If the <code>expect*OPCODE*</code> selector is matched, the rule will load the account into the state and add the <code>#setExpectOpcode</code> production to the K cell to initialize the <code>&lt;expectedOpcode/&gt;</code> subconfiguration with the given parameters.</p>
<pre><code class="language-k">    <span class="token keyword">rule</span> <span class="token punctuation">[</span>foundry<span class="token punctuation">.</span>call<span class="token punctuation">.</span>expectStaticCall<span class="token punctuation">]</span><span class="token punctuation">:</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #call_foundry SELECTOR ARGS
          <span class="token operator">=&gt;</span> #loadAccount #asWord<span class="token punctuation">(</span>#range<span class="token punctuation">(</span>ARGS<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
          <span class="token operator">~&gt;</span> #let CODE_START <span class="token operator">=</span> <span class="token number">96</span> #in
          #let DATA_LENGTH <span class="token operator">=</span> #asWord<span class="token punctuation">(</span>#range<span class="token punctuation">(</span>ARGS<span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">)</span> #in
          #setExpectOpcode #asWord<span class="token punctuation">(</span>#range<span class="token punctuation">(</span>ARGS<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">)</span> #range<span class="token punctuation">(</span>ARGS<span class="token punctuation">,</span> CODE_START<span class="token punctuation">,</span> DATA_LENGTH<span class="token punctuation">)</span> <span class="token number">0</span> Static
          <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
      <span class="token keyword">requires</span> SELECTOR <span class="token operator">==</span><span class="token keyword">Int</span> selector <span class="token punctuation">(</span> <span class="token string">"expectStaticCall(address,bytes)"</span> <span class="token punctuation">)</span>

    <span class="token keyword">rule</span> <span class="token punctuation">[</span>foundry<span class="token punctuation">.</span>call<span class="token punctuation">.</span>expectDelegateCall<span class="token punctuation">]</span><span class="token punctuation">:</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #call_foundry SELECTOR ARGS
          <span class="token operator">=&gt;</span> #loadAccount #asWord<span class="token punctuation">(</span>#range<span class="token punctuation">(</span>ARGS<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
          <span class="token operator">~&gt;</span> #let DATA_START <span class="token operator">=</span> <span class="token number">96</span> #in
          #let DATA_LENGTH <span class="token operator">=</span> #asWord<span class="token punctuation">(</span>#range<span class="token punctuation">(</span>ARGS<span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">)</span> #in
          #setExpectOpcode #asWord<span class="token punctuation">(</span>#range<span class="token punctuation">(</span>ARGS<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">)</span> #range<span class="token punctuation">(</span>ARGS<span class="token punctuation">,</span> DATA_START<span class="token punctuation">,</span> DATA_LENGTH<span class="token punctuation">)</span> <span class="token number">0</span> Delegate
          <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
      <span class="token keyword">requires</span> SELECTOR <span class="token operator">==</span><span class="token keyword">Int</span> selector <span class="token punctuation">(</span> <span class="token string">"expectDelegateCall(address,bytes)"</span> <span class="token punctuation">)</span>

    <span class="token keyword">rule</span> <span class="token punctuation">[</span>foundry<span class="token punctuation">.</span>call<span class="token punctuation">.</span>expectRegularCall<span class="token punctuation">]</span><span class="token punctuation">:</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #call_foundry SELECTOR ARGS
          <span class="token operator">=&gt;</span> #loadAccount #asWord<span class="token punctuation">(</span>#range<span class="token punctuation">(</span>ARGS<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
          <span class="token operator">~&gt;</span> #let DATA_START <span class="token operator">=</span> <span class="token number">128</span> #in
          #let DATA_LENGTH <span class="token operator">=</span> #asWord<span class="token punctuation">(</span>#range<span class="token punctuation">(</span>ARGS<span class="token punctuation">,</span> <span class="token number">96</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">)</span> #in
          #setExpectOpcode #asWord<span class="token punctuation">(</span>#range<span class="token punctuation">(</span>ARGS<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">)</span> #range<span class="token punctuation">(</span>ARGS<span class="token punctuation">,</span> DATA_START<span class="token punctuation">,</span> DATA_LENGTH<span class="token punctuation">)</span> #asWord<span class="token punctuation">(</span>#range<span class="token punctuation">(</span>ARGS<span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">)</span> Call
          <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
      <span class="token keyword">requires</span> SELECTOR <span class="token operator">==</span><span class="token keyword">Int</span> selector <span class="token punctuation">(</span> <span class="token string">"expectRegularCall(address,uint256,bytes)"</span> <span class="token punctuation">)</span>

    <span class="token keyword">rule</span> <span class="token punctuation">[</span>foundry<span class="token punctuation">.</span>call<span class="token punctuation">.</span>expectCreate<span class="token punctuation">]</span><span class="token punctuation">:</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #call_foundry SELECTOR ARGS
          <span class="token operator">=&gt;</span> #loadAccount #asWord<span class="token punctuation">(</span>#range<span class="token punctuation">(</span>ARGS<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
          <span class="token operator">~&gt;</span> #let DATA_START <span class="token operator">=</span> <span class="token number">128</span> #in
          #let DATA_LENGTH <span class="token operator">=</span> #asWord<span class="token punctuation">(</span>#range<span class="token punctuation">(</span>ARGS<span class="token punctuation">,</span> <span class="token number">96</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">)</span> #in
          #setExpectOpcode #asWord<span class="token punctuation">(</span>#range<span class="token punctuation">(</span>ARGS<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">)</span> #range<span class="token punctuation">(</span>ARGS<span class="token punctuation">,</span> DATA_START<span class="token punctuation">,</span> DATA_LENGTH<span class="token punctuation">)</span> #asWord<span class="token punctuation">(</span>#range<span class="token punctuation">(</span>ARGS<span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">)</span> Create
          <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
      <span class="token keyword">requires</span> SELECTOR <span class="token operator">==</span><span class="token keyword">Int</span> selector <span class="token punctuation">(</span> <span class="token string">"expectCreate(address,uint256,bytes)"</span> <span class="token punctuation">)</span>

    <span class="token keyword">rule</span> <span class="token punctuation">[</span>foundry<span class="token punctuation">.</span>call<span class="token punctuation">.</span>expectCreate2<span class="token punctuation">]</span><span class="token punctuation">:</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #call_foundry SELECTOR ARGS
          <span class="token operator">=&gt;</span> #loadAccount #asWord<span class="token punctuation">(</span>#range<span class="token punctuation">(</span>ARGS<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
          <span class="token operator">~&gt;</span> #let DATA_START <span class="token operator">=</span> <span class="token number">128</span> #in
          #let DATA_LENGTH <span class="token operator">=</span> #asWord<span class="token punctuation">(</span>#range<span class="token punctuation">(</span>ARGS<span class="token punctuation">,</span> <span class="token number">96</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">)</span> #in
          #setExpectOpcode #asWord<span class="token punctuation">(</span>#range<span class="token punctuation">(</span>ARGS<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">)</span> #range<span class="token punctuation">(</span>ARGS<span class="token punctuation">,</span> DATA_START<span class="token punctuation">,</span> DATA_LENGTH<span class="token punctuation">)</span> #asWord<span class="token punctuation">(</span>#range<span class="token punctuation">(</span>ARGS<span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">)</span> Create2
          <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
      <span class="token keyword">requires</span> SELECTOR <span class="token operator">==</span><span class="token keyword">Int</span> selector <span class="token punctuation">(</span> <span class="token string">"expectCreate2(address,uint256,bytes)"</span> <span class="token punctuation">)</span>
</code></pre>
<p>Next, everytime one of the <code>STATICCALL</code>, <code>DELEGATECALL</code>, <code>CALL</code>, <code>CREATE</code> or <code>CREATE2</code> opcodes is executed, we check if the <code>sender</code> address, <code>msg.value</code> and <code>calldata</code> match the expected values.
<code>calldata</code> needs to match only the first byte.</p>
<pre><code class="language-k">    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">(</span><span class="token punctuation">.</span> <span class="token operator">=&gt;</span> #clearExpectOpcode<span class="token punctuation">)</span> <span class="token operator">~&gt;</span> STATICCALL _GCAP ACCTTO ARGSTART ARGWIDTH _RETSTART _RETWIDTH <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>localMem</span><span class="token punctuation">&gt;</span></span> LM <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>localMem</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>expectedOpcode</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>isOpcodeExpected</span><span class="token punctuation">&gt;</span></span> <span class="token boolean">true</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>isOpcodeExpected</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>expectedAddress</span><span class="token punctuation">&gt;</span></span> ACCTTO <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>expectedAddress</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>expectedData</span><span class="token punctuation">&gt;</span></span> DATA <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>expectedData</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>opcodeType</span><span class="token punctuation">&gt;</span></span> Static <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>opcodeType</span><span class="token punctuation">&gt;</span></span>
           <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>expectedOpcode</span><span class="token punctuation">&gt;</span></span>
      <span class="token keyword">requires</span> #range<span class="token punctuation">(</span>LM<span class="token punctuation">,</span> ARGSTART<span class="token punctuation">,</span> ARGWIDTH<span class="token punctuation">)</span> <span class="token operator">==</span>K #range<span class="token punctuation">(</span>DATA<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> ARGWIDTH<span class="token punctuation">)</span>
      <span class="token punctuation">[</span>priority<span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">]</span>

    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">(</span><span class="token punctuation">.</span> <span class="token operator">=&gt;</span> #clearExpectOpcode<span class="token punctuation">)</span> <span class="token operator">~&gt;</span> DELEGATECALL _GCAP ACCTTO ARGSTART ARGWIDTH _RETSTART _RETWIDTH <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>localMem</span><span class="token punctuation">&gt;</span></span> LM <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>localMem</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>expectedOpcode</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>isOpcodeExpected</span><span class="token punctuation">&gt;</span></span> <span class="token boolean">true</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>isOpcodeExpected</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>expectedAddress</span><span class="token punctuation">&gt;</span></span> ACCTTO <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>expectedAddress</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>expectedData</span><span class="token punctuation">&gt;</span></span> DATA <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>expectedData</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>opcodeType</span><span class="token punctuation">&gt;</span></span> Delegate <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>opcodeType</span><span class="token punctuation">&gt;</span></span>
           <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>expectedOpcode</span><span class="token punctuation">&gt;</span></span>
      <span class="token keyword">requires</span> #range<span class="token punctuation">(</span>LM<span class="token punctuation">,</span> ARGSTART<span class="token punctuation">,</span> ARGWIDTH<span class="token punctuation">)</span> <span class="token operator">==</span>K #range<span class="token punctuation">(</span>DATA<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> ARGWIDTH<span class="token punctuation">)</span>
      <span class="token punctuation">[</span>priority<span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">]</span>

    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">(</span><span class="token punctuation">.</span> <span class="token operator">=&gt;</span> #clearExpectOpcode<span class="token punctuation">)</span> <span class="token operator">~&gt;</span> CALL _GCAP ACCTTO VALUE ARGSTART ARGWIDTH _RETSTART _RETWIDTH <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>localMem</span><span class="token punctuation">&gt;</span></span> LM <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>localMem</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>expectedOpcode</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>isOpcodeExpected</span><span class="token punctuation">&gt;</span></span> <span class="token boolean">true</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>isOpcodeExpected</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>expectedAddress</span><span class="token punctuation">&gt;</span></span> ACCTTO <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>expectedAddress</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>expectedData</span><span class="token punctuation">&gt;</span></span> DATA <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>expectedData</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>opcodeType</span><span class="token punctuation">&gt;</span></span> Call <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>opcodeType</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>expectedValue</span><span class="token punctuation">&gt;</span></span> VALUE <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>expectedValue</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>expectedOpcode</span><span class="token punctuation">&gt;</span></span>
      <span class="token keyword">requires</span> #range<span class="token punctuation">(</span>LM<span class="token punctuation">,</span> ARGSTART<span class="token punctuation">,</span> ARGWIDTH<span class="token punctuation">)</span> <span class="token operator">==</span>K #range<span class="token punctuation">(</span>DATA<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> ARGWIDTH<span class="token punctuation">)</span>
      <span class="token punctuation">[</span>priority<span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">]</span>

    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">(</span><span class="token punctuation">.</span> <span class="token operator">=&gt;</span> #clearExpectOpcode<span class="token punctuation">)</span> <span class="token operator">~&gt;</span> CREATE VALUE MEMSTART MEMWIDTH <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>localMem</span><span class="token punctuation">&gt;</span></span> LM <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>localMem</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">&gt;</span></span> ACCT <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>expectedOpcode</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>isOpcodeExpected</span><span class="token punctuation">&gt;</span></span> <span class="token boolean">true</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>isOpcodeExpected</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>expectedAddress</span><span class="token punctuation">&gt;</span></span> ACCT <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>expectedAddress</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>expectedData</span><span class="token punctuation">&gt;</span></span> DATA <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>expectedData</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>opcodeType</span><span class="token punctuation">&gt;</span></span> Create <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>opcodeType</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>expectedValue</span><span class="token punctuation">&gt;</span></span> VALUE <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>expectedValue</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>expectedOpcode</span><span class="token punctuation">&gt;</span></span>
      <span class="token keyword">requires</span> #range<span class="token punctuation">(</span>LM<span class="token punctuation">,</span> MEMSTART<span class="token punctuation">,</span> MEMWIDTH<span class="token punctuation">)</span> <span class="token operator">==</span>K #range<span class="token punctuation">(</span>DATA<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> MEMWIDTH<span class="token punctuation">)</span>
      <span class="token punctuation">[</span>priority<span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">]</span>

    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">(</span><span class="token punctuation">.</span> <span class="token operator">=&gt;</span> #clearExpectOpcode<span class="token punctuation">)</span> <span class="token operator">~&gt;</span> CREATE2 VALUE MEMSTART MEMWIDTH _SALT <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>localMem</span><span class="token punctuation">&gt;</span></span> LM <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>localMem</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">&gt;</span></span> ACCT <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>expectedOpcode</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>isOpcodeExpected</span><span class="token punctuation">&gt;</span></span> <span class="token boolean">true</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>isOpcodeExpected</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>expectedAddress</span><span class="token punctuation">&gt;</span></span> ACCT <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>expectedAddress</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>expectedData</span><span class="token punctuation">&gt;</span></span> DATA <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>expectedData</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>opcodeType</span><span class="token punctuation">&gt;</span></span> Create2 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>opcodeType</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>expectedValue</span><span class="token punctuation">&gt;</span></span> VALUE <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>expectedValue</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>expectedOpcode</span><span class="token punctuation">&gt;</span></span>
      <span class="token keyword">requires</span> #range<span class="token punctuation">(</span>LM<span class="token punctuation">,</span> MEMSTART<span class="token punctuation">,</span> MEMWIDTH<span class="token punctuation">)</span> <span class="token operator">==</span>K #range<span class="token punctuation">(</span>DATA<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> MEMWIDTH<span class="token punctuation">)</span>
      <span class="token punctuation">[</span>priority<span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
</code></pre>
<h2 id="pranks">Pranks</h2>
<h4 id="injecting-addresses-in-a-call">Injecting addresses in a call</h4>
<p>To inject the pranked <code>msg.sender</code> and <code>tx.origin</code> we add two new rules for the <code>#call</code> production, defined in <a href="../evm/">evm.md</a>.
These rules have a higher priority.
The only difference between these rules is that one will also set the <code>tx.origin</code>, if required.
First, will match only if the <code>&lt;active&gt;</code> cell has the <code>true</code> value, signaling that a prank is active, and if the current depth of the call is at the same level with the depth at which the prank was invoked.
This is needed in order to prevent overwriting the caller for subcalls.
Finally, the original sender of the transaction, <code>ACCTFROM</code> is changed to the new caller, <code>NCL</code>.</p>
<pre><code class="language-k">    <span class="token keyword">rule</span> <span class="token punctuation">[</span>foundry<span class="token punctuation">.</span>prank<span class="token punctuation">.</span>injectCaller<span class="token punctuation">]</span><span class="token punctuation">:</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #call <span class="token punctuation">(</span>ACCTFROM <span class="token operator">=&gt;</span> NCL<span class="token punctuation">)</span> _ACCTTO _ACCTCODE _VALUE _APPVALUE _ARGS _STATIC <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>callDepth</span><span class="token punctuation">&gt;</span></span> CD <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>callDepth</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>prank</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>newCaller</span><span class="token punctuation">&gt;</span></span> NCL <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>newCaller</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>newOrigin</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">.</span>Account <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>newOrigin</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>active</span><span class="token punctuation">&gt;</span></span> <span class="token boolean">true</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>active</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>depth</span><span class="token punctuation">&gt;</span></span> CD <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>depth</span><span class="token punctuation">&gt;</span></span>
            <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>prank</span><span class="token punctuation">&gt;</span></span>
      <span class="token keyword">requires</span> NCL <span class="token operator">=</span><span class="token operator">/</span><span class="token operator">=</span>K <span class="token punctuation">.</span>Account
       andBool ACCTFROM <span class="token operator">=</span><span class="token operator">/</span><span class="token operator">=</span><span class="token keyword">Int</span> NCL
      <span class="token punctuation">[</span>priority<span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">]</span>

    <span class="token keyword">rule</span> <span class="token punctuation">[</span>foundry<span class="token punctuation">.</span>prank<span class="token punctuation">.</span>injectCallerAndOrigin<span class="token punctuation">]</span><span class="token punctuation">:</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #call <span class="token punctuation">(</span>ACCTFROM <span class="token operator">=&gt;</span> NCL<span class="token punctuation">)</span> _ACCTTO _ACCTCODE _VALUE _APPVALUE _ARGS _STATIC <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>callDepth</span><span class="token punctuation">&gt;</span></span> CD <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>callDepth</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>origin</span><span class="token punctuation">&gt;</span></span> _ <span class="token operator">=&gt;</span> NOG <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>origin</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>prank</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>newCaller</span><span class="token punctuation">&gt;</span></span> NCL <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>newCaller</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>newOrigin</span><span class="token punctuation">&gt;</span></span> NOG <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>newOrigin</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>active</span><span class="token punctuation">&gt;</span></span> <span class="token boolean">true</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>active</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>depth</span><span class="token punctuation">&gt;</span></span> CD <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>depth</span><span class="token punctuation">&gt;</span></span>
            <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>prank</span><span class="token punctuation">&gt;</span></span>
      <span class="token keyword">requires</span> NCL <span class="token operator">=</span><span class="token operator">/</span><span class="token operator">=</span>K <span class="token punctuation">.</span>Account
       andBool NOG <span class="token operator">=</span><span class="token operator">/</span><span class="token operator">=</span>K <span class="token punctuation">.</span>Account
       andBool ACCTFROM <span class="token operator">=</span><span class="token operator">/</span><span class="token operator">=</span><span class="token keyword">Int</span> NCL
      <span class="token punctuation">[</span>priority<span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
</code></pre>
<p>We define a new rule for the <code>#halt ~&gt; #return _ _</code> production that will trigger the <code>#endPrank</code> rules if the prank was set only for a single call and if the current call depth is equal to the depth at which <code>prank</code> was invoked plus one.</p>
<pre><code class="language-k">    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">(</span><span class="token punctuation">.</span> <span class="token operator">=&gt;</span> #endPrank<span class="token punctuation">)</span> <span class="token operator">~&gt;</span> #halt <span class="token operator">~&gt;</span> #return _RETSTART _RETWIDTH <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>callDepth</span><span class="token punctuation">&gt;</span></span> CD <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>callDepth</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>prank</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>singleCall</span><span class="token punctuation">&gt;</span></span> <span class="token boolean">true</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>singleCall</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>depth</span><span class="token punctuation">&gt;</span></span> PD <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>depth</span><span class="token punctuation">&gt;</span></span>
           <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>prank</span><span class="token punctuation">&gt;</span></span>
      <span class="token keyword">requires</span> CD <span class="token operator">==</span><span class="token keyword">Int</span> PD <span class="token operator">+</span><span class="token keyword">Int</span> <span class="token number">1</span>
      <span class="token punctuation">[</span>priority<span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
</code></pre>
<h4 id="startprank---sets-msg.sender-and-tx.origin-for-all-subsequent-calls-until-stopprank-is-called."><code>startPrank</code> - Sets <code>msg.sender</code> and <code>tx.origin</code> for all subsequent calls until <code>stopPrank</code> is called.</h4>
<pre><code>function startPrank(address) external;
function startPrank(address sender, address origin) external;
</code></pre>
<p><code>foundry.call.startPrank</code> and <code>foundry.call.startPrankWithOrigin</code> will match when either of <code>startPrank</code> functions are called.
The addresses which will be used to impersonate future calls are retrieved from the local memory using <code>#asWord(#range(ARGS, 0, 32)</code> for the sender, and <code>#asWord(#range(ARGS, 32, 32)</code> for the origin (only for the <code>foundry.call.startPrankWithOrigin</code> rule).
The <code>#loadAccount</code> production is used to load accounts into the state if they are missing.</p>
<pre><code class="language-k">    <span class="token keyword">rule</span> <span class="token punctuation">[</span>foundry<span class="token punctuation">.</span>call<span class="token punctuation">.</span>startPrank<span class="token punctuation">]</span><span class="token punctuation">:</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #call_foundry SELECTOR ARGS <span class="token operator">=&gt;</span> #loadAccount #asWord<span class="token punctuation">(</span>ARGS<span class="token punctuation">)</span> <span class="token operator">~&gt;</span> #setPrank #asWord<span class="token punctuation">(</span>ARGS<span class="token punctuation">)</span> <span class="token punctuation">.</span>Account <span class="token boolean">false</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
      <span class="token keyword">requires</span> SELECTOR <span class="token operator">==</span><span class="token keyword">Int</span> selector <span class="token punctuation">(</span> <span class="token string">"startPrank(address)"</span> <span class="token punctuation">)</span>

    <span class="token keyword">rule</span> <span class="token punctuation">[</span>foundry<span class="token punctuation">.</span>call<span class="token punctuation">.</span>startPrankWithOrigin<span class="token punctuation">]</span><span class="token punctuation">:</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #call_foundry SELECTOR ARGS <span class="token operator">=&gt;</span> #loadAccount #asWord<span class="token punctuation">(</span>#range<span class="token punctuation">(</span>ARGS<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">~&gt;</span> #loadAccount #asWord<span class="token punctuation">(</span>#range<span class="token punctuation">(</span>ARGS<span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">~&gt;</span> #setPrank #asWord<span class="token punctuation">(</span>#range<span class="token punctuation">(</span>ARGS<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">)</span> #asWord<span class="token punctuation">(</span>#range<span class="token punctuation">(</span>ARGS<span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token boolean">false</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
      <span class="token keyword">requires</span> SELECTOR <span class="token operator">==</span><span class="token keyword">Int</span> selector <span class="token punctuation">(</span> <span class="token string">"startPrank(address,address)"</span> <span class="token punctuation">)</span>
</code></pre>
<h4 id="prank---impersonate-msg.sender-and-tx.origin-for-only-for-the-next-call."><code>prank</code> - Impersonate <code>msg.sender</code> and <code>tx.origin</code> for only for the next call.</h4>
<pre><code>function prank(address) external;
function prank(address sender, address origin) external;
</code></pre>
<pre><code class="language-k">    <span class="token keyword">rule</span> <span class="token punctuation">[</span>foundry<span class="token punctuation">.</span>call<span class="token punctuation">.</span>prank<span class="token punctuation">]</span><span class="token punctuation">:</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #call_foundry SELECTOR ARGS <span class="token operator">=&gt;</span> #loadAccount #asWord<span class="token punctuation">(</span>ARGS<span class="token punctuation">)</span> <span class="token operator">~&gt;</span> #setPrank #asWord<span class="token punctuation">(</span>ARGS<span class="token punctuation">)</span> <span class="token punctuation">.</span>Account <span class="token boolean">true</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
      <span class="token keyword">requires</span> SELECTOR <span class="token operator">==</span><span class="token keyword">Int</span> selector <span class="token punctuation">(</span> <span class="token string">"prank(address)"</span> <span class="token punctuation">)</span>

    <span class="token keyword">rule</span> <span class="token punctuation">[</span>foundry<span class="token punctuation">.</span>call<span class="token punctuation">.</span>prankWithOrigin<span class="token punctuation">]</span><span class="token punctuation">:</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #call_foundry SELECTOR ARGS <span class="token operator">=&gt;</span> #loadAccount #asWord<span class="token punctuation">(</span>#range<span class="token punctuation">(</span>ARGS<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">~&gt;</span> #loadAccount #asWord<span class="token punctuation">(</span>#range<span class="token punctuation">(</span>ARGS<span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">~&gt;</span> #setPrank #asWord<span class="token punctuation">(</span>#range<span class="token punctuation">(</span>ARGS<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">)</span> #asWord<span class="token punctuation">(</span>#range<span class="token punctuation">(</span>ARGS<span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token boolean">true</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
      <span class="token keyword">requires</span> SELECTOR <span class="token operator">==</span><span class="token keyword">Int</span> selector <span class="token punctuation">(</span> <span class="token string">"prank(address,address)"</span> <span class="token punctuation">)</span>
</code></pre>
<h4 id="stopprank---stops-impersonating-msg.sender-and-tx.origin."><code>stopPrank</code> - Stops impersonating <code>msg.sender</code> and <code>tx.origin</code>.</h4>
<pre><code>function stopPrank() external;
</code></pre>
<p><code>foundry.call.stopPrank</code> will match when <code>stopPrank</code> function will be called. This rule will invoke <code>#endPrank</code> which will clean up the <code>&lt;prank/&gt;</code> subconfiguration and restore the previous values of the <code>msg.sender</code> and <code>tx.origin</code>.</p>
<pre><code class="language-k">    <span class="token keyword">rule</span> <span class="token punctuation">[</span>foundry<span class="token punctuation">.</span>call<span class="token punctuation">.</span>stopPrank<span class="token punctuation">]</span><span class="token punctuation">:</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #call_foundry SELECTOR _ <span class="token operator">=&gt;</span> #endPrank <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
      <span class="token keyword">requires</span> SELECTOR <span class="token operator">==</span><span class="token keyword">Int</span> selector <span class="token punctuation">(</span> <span class="token string">"stopPrank()"</span> <span class="token punctuation">)</span>
</code></pre>
<h2 id="expecting-events">Expecting Events</h2>
<pre><code>function expectEmit(bool checkTopic1, bool checkTopic2, bool checkTopic3, bool checkData) external;
function expectEmit(bool checkTopic1, bool checkTopic2, bool checkTopic3, bool checkData, address emitter) external;
</code></pre>
<p>Assert a specific log is emitted before the end of the current function.</p>
<p>Call the cheat code, specifying whether we should check the first, second or third topic, and the log data.
Topic 0 is always checked.
Emit the event we are supposed to see before the end of the current function.
Perform the call.
If the event is not available in the current scope (e.g. if we are using an interface, or an external smart contract), we can define the event ourselves with an identical event signature.</p>
<p>There are 2 signatures:</p>
<p>Without checking the emitter address: Asserts the topics match without checking the emitting address.
With address: Asserts the topics match and that the emitting address matches.</p>
<pre><code class="language-k">    <span class="token keyword">rule</span> <span class="token punctuation">[</span>foundry<span class="token punctuation">.</span>call<span class="token punctuation">.</span>expectEmit<span class="token punctuation">]</span><span class="token punctuation">:</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #call_foundry SELECTOR ARGS <span class="token operator">=&gt;</span> #setExpectEmit word2Bool<span class="token punctuation">(</span>#asWord<span class="token punctuation">(</span>#range<span class="token punctuation">(</span>ARGS<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> word2Bool<span class="token punctuation">(</span>#asWord<span class="token punctuation">(</span>#range<span class="token punctuation">(</span>ARGS<span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> word2Bool<span class="token punctuation">(</span>#asWord<span class="token punctuation">(</span>#range<span class="token punctuation">(</span>ARGS<span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> word2Bool<span class="token punctuation">(</span>#asWord<span class="token punctuation">(</span>#range<span class="token punctuation">(</span>ARGS<span class="token punctuation">,</span> <span class="token number">96</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">.</span>Account <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
      <span class="token keyword">requires</span> SELECTOR <span class="token operator">==</span><span class="token keyword">Int</span> selector <span class="token punctuation">(</span> <span class="token string">"expectEmit(bool,bool,bool,bool)"</span> <span class="token punctuation">)</span>

    <span class="token keyword">rule</span> <span class="token punctuation">[</span>foundry<span class="token punctuation">.</span>call<span class="token punctuation">.</span>expectEmitAddr<span class="token punctuation">]</span><span class="token punctuation">:</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #call_foundry SELECTOR ARGS <span class="token operator">=&gt;</span> #setExpectEmit word2Bool<span class="token punctuation">(</span>#asWord<span class="token punctuation">(</span>#range<span class="token punctuation">(</span>ARGS<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> word2Bool<span class="token punctuation">(</span>#asWord<span class="token punctuation">(</span>#range<span class="token punctuation">(</span>ARGS<span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> word2Bool<span class="token punctuation">(</span>#asWord<span class="token punctuation">(</span>#range<span class="token punctuation">(</span>ARGS<span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> word2Bool<span class="token punctuation">(</span>#asWord<span class="token punctuation">(</span>#range<span class="token punctuation">(</span>ARGS<span class="token punctuation">,</span> <span class="token number">96</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> #asWord<span class="token punctuation">(</span>#range<span class="token punctuation">(</span>ARGS<span class="token punctuation">,</span> <span class="token number">128</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
      <span class="token keyword">requires</span> SELECTOR <span class="token operator">==</span><span class="token keyword">Int</span> selector <span class="token punctuation">(</span> <span class="token string">"expectEmit(bool,bool,bool,bool,address)"</span> <span class="token punctuation">)</span>
</code></pre>
<pre><code class="language-k">    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> LOG<span class="token punctuation">(</span>N<span class="token punctuation">)</span> _MEMSTART _MEMWIDTH <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>expectEmit</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>recordEvent</span><span class="token punctuation">&gt;</span></span> <span class="token boolean">true</span> <span class="token operator">=&gt;</span> <span class="token boolean">false</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>recordEvent</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>isEventExpected</span><span class="token punctuation">&gt;</span></span> <span class="token boolean">false</span> <span class="token operator">=&gt;</span> <span class="token boolean">true</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>isEventExpected</span><span class="token punctuation">&gt;</span></span>
          <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>expectEmit</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>wordStack</span><span class="token punctuation">&gt;</span></span> WS <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>wordStack</span><span class="token punctuation">&gt;</span></span>
      <span class="token keyword">requires</span> #sizeWordStack<span class="token punctuation">(</span>WS<span class="token punctuation">)</span> <span class="token operator">&gt;=</span><span class="token keyword">Int</span> N
      <span class="token punctuation">[</span>priority<span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">]</span>

    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">(</span><span class="token punctuation">.</span> <span class="token operator">=&gt;</span> #clearExpectEmit<span class="token punctuation">)</span> <span class="token operator">~&gt;</span> LOG<span class="token punctuation">(</span>N<span class="token punctuation">)</span> MEMSTART MEMWIDTH <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>log</span><span class="token punctuation">&gt;</span></span> _ ListItem<span class="token punctuation">(</span><span class="token punctuation">{</span> _ <span class="token operator">|</span> TOPICS <span class="token operator">|</span> DATA <span class="token punctuation">}</span><span class="token punctuation">:</span>SubstateLogEntry<span class="token punctuation">)</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>log</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>expectEmit</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>recordEvent</span><span class="token punctuation">&gt;</span></span> <span class="token boolean">false</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>recordEvent</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>isEventExpected</span><span class="token punctuation">&gt;</span></span> <span class="token boolean">true</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>isEventExpected</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>checkedTopics</span><span class="token punctuation">&gt;</span></span> CHECKS <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>checkedTopics</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>checkedData</span><span class="token punctuation">&gt;</span></span> CHECKDATA <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>checkedData</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>expectedEventAddress</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">.</span>Account <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>expectedEventAddress</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>expectEmit</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>wordStack</span><span class="token punctuation">&gt;</span></span> WS <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>wordStack</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>localMem</span><span class="token punctuation">&gt;</span></span> LM <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>localMem</span><span class="token punctuation">&gt;</span></span>
      <span class="token keyword">requires</span> #sizeWordStack<span class="token punctuation">(</span>WS<span class="token punctuation">)</span> <span class="token operator">&gt;=</span><span class="token keyword">Int</span> N
       andBool  #checkTopics<span class="token punctuation">(</span>CHECKS<span class="token punctuation">,</span> TOPICS<span class="token punctuation">,</span> WordStack2List<span class="token punctuation">(</span>#take<span class="token punctuation">(</span>N<span class="token punctuation">,</span> WS<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
       andBool <span class="token punctuation">(</span><span class="token punctuation">(</span>notBool CHECKDATA<span class="token punctuation">)</span> orBool <span class="token punctuation">(</span>#asWord<span class="token punctuation">(</span>DATA<span class="token punctuation">)</span> <span class="token operator">==</span><span class="token keyword">Int</span> #asWord<span class="token punctuation">(</span>#range<span class="token punctuation">(</span>LM<span class="token punctuation">,</span> MEMSTART<span class="token punctuation">,</span> MEMWIDTH<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">[</span>priority<span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">]</span>

    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">(</span><span class="token punctuation">.</span> <span class="token operator">=&gt;</span> #clearExpectEmit<span class="token punctuation">)</span> <span class="token operator">~&gt;</span> LOG<span class="token punctuation">(</span>N<span class="token punctuation">)</span> MEMSTART MEMWIDTH <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>log</span><span class="token punctuation">&gt;</span></span> _ ListItem<span class="token punctuation">(</span><span class="token punctuation">{</span> _ <span class="token operator">|</span> TOPICS <span class="token operator">|</span> DATA <span class="token punctuation">}</span><span class="token punctuation">:</span>SubstateLogEntry<span class="token punctuation">)</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>log</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">&gt;</span></span> ACCT <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>expectEmit</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>recordEvent</span><span class="token punctuation">&gt;</span></span> <span class="token boolean">false</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>recordEvent</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>isEventExpected</span><span class="token punctuation">&gt;</span></span> <span class="token boolean">true</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>isEventExpected</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>checkedTopics</span><span class="token punctuation">&gt;</span></span> CHECKS <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>checkedTopics</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>checkedData</span><span class="token punctuation">&gt;</span></span> CHECKDATA <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>checkedData</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>expectedEventAddress</span><span class="token punctuation">&gt;</span></span> ACCT <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>expectedEventAddress</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>expectEmit</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>wordStack</span><span class="token punctuation">&gt;</span></span> WS <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>wordStack</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>localMem</span><span class="token punctuation">&gt;</span></span> LM <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>localMem</span><span class="token punctuation">&gt;</span></span>
      <span class="token keyword">requires</span> #sizeWordStack<span class="token punctuation">(</span>WS<span class="token punctuation">)</span> <span class="token operator">&gt;=</span><span class="token keyword">Int</span> N
       andBool  #checkTopics<span class="token punctuation">(</span>CHECKS<span class="token punctuation">,</span> TOPICS<span class="token punctuation">,</span> WordStack2List<span class="token punctuation">(</span>#take<span class="token punctuation">(</span>N<span class="token punctuation">,</span> WS<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
       andBool <span class="token punctuation">(</span><span class="token punctuation">(</span>notBool CHECKDATA<span class="token punctuation">)</span> orBool <span class="token punctuation">(</span>#asWord<span class="token punctuation">(</span>DATA<span class="token punctuation">)</span> <span class="token operator">==</span><span class="token keyword">Int</span> #asWord<span class="token punctuation">(</span>#range<span class="token punctuation">(</span>LM<span class="token punctuation">,</span> MEMSTART<span class="token punctuation">,</span> MEMWIDTH<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">[</span>priority<span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
</code></pre>
<h2 id="restricting-the-accounts-that-can-be-called-in-kevm">Restricting the accounts that can be called in KEVM</h2>
<p>A <code>StorageSlot</code> pair is formed from an address and a storage index.</p>
<pre><code class="language-k">    <span class="token keyword">syntax</span> StorageSlot <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">"{"</span> <span class="token keyword">Int</span> <span class="token string">"|"</span> <span class="token keyword">Int</span> <span class="token string">"}"</span>
 <span class="token comment">// ------------------------------------------</span>
</code></pre>
<p>The <code>ACCTTO</code> value is checked for each call while the whitelist restriction is enabled for calls.
If the address is not in the whitelist <code>WLIST</code> then <code>KEVM</code> goes into an error state providing the <code>ACCTTO</code> value.</p>
<pre><code class="language-k">    <span class="token keyword">rule</span> <span class="token punctuation">[</span>foundry<span class="token punctuation">.</span>catchNonWhitelistedCalls<span class="token punctuation">]</span><span class="token punctuation">:</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">(</span>#call _ ACCTTO _ _ _ _ <span class="token boolean">false</span>
          <span class="token operator">~&gt;</span> #popCallStack
          <span class="token operator">~&gt;</span> #popWorldState<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #end FOUNDRY_WHITELISTCALL <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>whitelist</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>isCallWhitelistActive</span><span class="token punctuation">&gt;</span></span> <span class="token boolean">true</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>isCallWhitelistActive</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>addressSet</span><span class="token punctuation">&gt;</span></span> WLIST <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>addressSet</span><span class="token punctuation">&gt;</span></span>
           <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>whitelist</span><span class="token punctuation">&gt;</span></span>
      <span class="token keyword">requires</span> notBool ACCTTO in WLIST
      <span class="token punctuation">[</span>priority<span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
</code></pre>
<p>When the storage whitelist restriction is enabled, the <code>SSTORE</code> operation will check if the address and the storage index are in the whitelist.
If the pair is not present in the whitelist <code>WLIST</code> then <code>KEVM</code> goes into an error state providing the address and the storage index values.</p>
<pre><code class="language-k">    <span class="token keyword">rule</span> <span class="token punctuation">[</span>foundry<span class="token punctuation">.</span>catchNonWhitelistedStorageChanges<span class="token punctuation">]</span><span class="token punctuation">:</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> SSTORE INDEX _ <span class="token operator">=&gt;</span> #end FOUNDRY_WHITELISTSTORAGE <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">&gt;</span></span> ACCT <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>statusCode</span><span class="token punctuation">&gt;</span></span> _ <span class="token operator">=&gt;</span> FOUNDRY_WHITELISTSTORAGE <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>statusCode</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>whitelist</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>isStorageWhitelistActive</span><span class="token punctuation">&gt;</span></span> <span class="token boolean">true</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>isStorageWhitelistActive</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>storageSlotSet</span><span class="token punctuation">&gt;</span></span> WLIST <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>storageSlotSet</span><span class="token punctuation">&gt;</span></span>
           <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>whitelist</span><span class="token punctuation">&gt;</span></span>
      <span class="token keyword">requires</span> notBool <span class="token punctuation">{</span>ACCT<span class="token operator">|</span>INDEX<span class="token punctuation">}</span> in WLIST
      <span class="token punctuation">[</span>priority<span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
</code></pre>
<h4 id="allowcallstoaddress---add-an-account-address-to-a-whitelist."><code>allowCallsToAddress</code> - Add an account address to a whitelist.</h4>
<pre><code>function allowCallsToAddress(address) external;
</code></pre>
<p>Adds an account address to the whitelist. The execution of the modified KEVM will stop when a call has been made to an address which is not in the whitelist.</p>
<pre><code class="language-k">    <span class="token keyword">rule</span> <span class="token punctuation">[</span>foundry<span class="token punctuation">.</span>allowCallsToAddress<span class="token punctuation">]</span><span class="token punctuation">:</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #call_foundry SELECTOR ARGS <span class="token operator">=&gt;</span> #loadAccount #asWord<span class="token punctuation">(</span>ARGS<span class="token punctuation">)</span> <span class="token operator">~&gt;</span> #addAddressToWhitelist #asWord<span class="token punctuation">(</span>ARGS<span class="token punctuation">)</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token keyword">requires</span> SELECTOR <span class="token operator">==</span><span class="token keyword">Int</span> selector <span class="token punctuation">(</span> <span class="token string">"allowCallsToAddress(address)"</span> <span class="token punctuation">)</span>
</code></pre>
<h4 id="allowchangestostorage---add-an-account-address-and-a-storage-slot-to-a-whitelist."><code>allowChangesToStorage</code> - Add an account address and a storage slot to a whitelist.</h4>
<pre><code>function allowChangesToStorage(address,uint256) external;
</code></pre>
<pre><code class="language-k">    <span class="token keyword">rule</span> <span class="token punctuation">[</span>foundry<span class="token punctuation">.</span>allowStorageSlotToAddress<span class="token punctuation">]</span><span class="token punctuation">:</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #call_foundry SELECTOR ARGS <span class="token operator">=&gt;</span> #loadAccount #asWord<span class="token punctuation">(</span>ARGS<span class="token punctuation">)</span> <span class="token operator">~&gt;</span> #addStorageSlotToWhitelist <span class="token punctuation">{</span> #asWord<span class="token punctuation">(</span>#range<span class="token punctuation">(</span>ARGS<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">|</span> #asWord<span class="token punctuation">(</span>#range<span class="token punctuation">(</span>ARGS<span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">}</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token keyword">requires</span> SELECTOR <span class="token operator">==</span><span class="token keyword">Int</span> selector <span class="token punctuation">(</span> <span class="token string">"allowChangesToStorage(address,uint256)"</span> <span class="token punctuation">)</span>
</code></pre>
<h4 id="sign---signs-a-digest-with-private-key"><code>sign</code> - Signs a digest with private key</h4>
<pre><code>function sign(uint256 privateKey, bytes32 digest) external returns (uint8 v, bytes32 r, bytes32 s);
</code></pre>
<p><code>foundry.call.sign</code> will match when the <code>sign</code> cheat code function is called.
This rule then takes from the <code>privateKey</code> to sign using <code>#range(ARGS,0,32)</code> and the <code>digest</code> to be signed using <code>#range(ARGS, 32, 32)</code>.
To perform the signature we use the <code>ECDSASign ( String, String )</code> function (from KEVM).
This function receives as arguments 2 strings: the data to be signed and the private key, therefore we use <code>#unparseByteStack</code> to convert the bytearrays with the <code>privateKey</code> and <code>digest</code> into strings.
The <code>ECDSASign</code> function returns the signed data in [r,s,v] form, which we convert to a bytearray using <code>#parseByteStack</code>.</p>
<pre><code class="language-k">    <span class="token keyword">rule</span> <span class="token punctuation">[</span>foundry<span class="token punctuation">.</span>call<span class="token punctuation">.</span>sign<span class="token punctuation">]</span><span class="token punctuation">:</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #call_foundry SELECTOR ARGS <span class="token operator">=&gt;</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>output</span><span class="token punctuation">&gt;</span></span> _ <span class="token operator">=&gt;</span> #sign<span class="token punctuation">(</span>#range<span class="token punctuation">(</span>ARGS<span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">,</span>#range<span class="token punctuation">(</span>ARGS<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>output</span><span class="token punctuation">&gt;</span></span>
      <span class="token keyword">requires</span> SELECTOR <span class="token operator">==</span><span class="token keyword">Int</span> selector <span class="token punctuation">(</span> <span class="token string">"sign(uint256,bytes32)"</span> <span class="token punctuation">)</span>
</code></pre>
<p>Otherwise, throw an error for any other call to the Foundry contract.</p>
<pre><code class="language-k">    <span class="token keyword">rule</span> <span class="token punctuation">[</span>foundry<span class="token punctuation">.</span>call<span class="token punctuation">.</span>owise<span class="token punctuation">]</span><span class="token punctuation">:</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #call_foundry SELECTOR ARGS <span class="token operator">=&gt;</span> #error_foundry SELECTOR ARGS <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>statusCode</span><span class="token punctuation">&gt;</span></span> _ <span class="token operator">=&gt;</span> FOUNDRY_UNIMPLEMENTED <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>statusCode</span><span class="token punctuation">&gt;</span></span>
      <span class="token punctuation">[</span>owise<span class="token punctuation">]</span>
</code></pre>
<h2 id="utils">Utils</h2>
<ul>
<li><code>#loadAccount ACCT</code> creates a new, empty account for <code>ACCT</code> if it does not already exist. Otherwise, it has no effect.</li>
</ul>
<pre><code class="language-k">    <span class="token keyword">syntax</span> KItem <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">"#loadAccount"</span> <span class="token keyword">Int</span> <span class="token punctuation">[</span><span class="token class-name">klabel</span><span class="token punctuation">(</span>foundry_loadAccount<span class="token punctuation">)</span><span class="token punctuation">]</span>
 <span class="token comment">// -----------------------------------------------------------------</span>
    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #loadAccount ACCT <span class="token operator">=&gt;</span> #accessAccounts ACCT <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>activeAccounts</span><span class="token punctuation">&gt;</span></span> ACCTS<span class="token punctuation">:</span>Set <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>activeAccounts</span><span class="token punctuation">&gt;</span></span>
      <span class="token keyword">requires</span> ACCT in ACCTS

    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #loadAccount ACCT <span class="token operator">=&gt;</span> #newAccount ACCT <span class="token operator">~&gt;</span> #accessAccounts ACCT <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>activeAccounts</span><span class="token punctuation">&gt;</span></span> ACCTS<span class="token punctuation">:</span>Set <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>activeAccounts</span><span class="token punctuation">&gt;</span></span>
      <span class="token keyword">requires</span> notBool ACCT in ACCTS
</code></pre>
<ul>
<li><code>#setBalance ACCTID NEWBAL</code> sets the balance of a given account.</li>
</ul>
<pre><code class="language-k">    <span class="token keyword">syntax</span> KItem <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">"#setBalance"</span> <span class="token keyword">Int</span> <span class="token keyword">Int</span> <span class="token punctuation">[</span><span class="token class-name">klabel</span><span class="token punctuation">(</span>foundry_setBalance<span class="token punctuation">)</span><span class="token punctuation">]</span>
 <span class="token comment">// -------------------------------------------------------------------</span>
    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #setBalance ACCTID NEWBAL <span class="token operator">=&gt;</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>account</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>acctID</span><span class="token punctuation">&gt;</span></span> ACCTID <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>acctID</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>balance</span><span class="token punctuation">&gt;</span></span> _ <span class="token operator">=&gt;</span> NEWBAL <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>balance</span><span class="token punctuation">&gt;</span></span>
           <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>account</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<ul>
<li><code>#setCode ACCTID CODE</code> sets the code of a given account.</li>
</ul>
<pre><code class="language-k">    <span class="token keyword">syntax</span> KItem <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">"#setCode"</span> <span class="token keyword">Int</span> ByteArray <span class="token punctuation">[</span><span class="token class-name">klabel</span><span class="token punctuation">(</span>foundry_setCode<span class="token punctuation">)</span><span class="token punctuation">]</span>
 <span class="token comment">// -------------------------------------------------------------------</span>
    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #setCode ACCTID CODE <span class="token operator">=&gt;</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>account</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>acctID</span><span class="token punctuation">&gt;</span></span> ACCTID <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>acctID</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>code</span><span class="token punctuation">&gt;</span></span> _ <span class="token operator">=&gt;</span> #if #asWord<span class="token punctuation">(</span>CODE<span class="token punctuation">)</span> <span class="token operator">==</span><span class="token keyword">Int</span> <span class="token number">0</span> #then <span class="token punctuation">.</span>ByteArray<span class="token punctuation">:</span>AccountCode #else <span class="token punctuation">{</span>CODE<span class="token punctuation">}</span><span class="token punctuation">:</span>&gt;AccountCode #fi <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>code</span><span class="token punctuation">&gt;</span></span>
           <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>account</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<ul>
<li><code>#returnNonce ACCTID</code> takes the nonce of a given account and places it on the <code>&lt;output&gt;</code> cell.</li>
</ul>
<pre><code class="language-k">    <span class="token keyword">syntax</span> KItem <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">"#returnNonce"</span> <span class="token keyword">Int</span> <span class="token punctuation">[</span><span class="token class-name">klabel</span><span class="token punctuation">(</span>foundry_returnNonce<span class="token punctuation">)</span><span class="token punctuation">]</span>
 <span class="token comment">// -----------------------------------------------------------------</span>
    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #returnNonce ACCTID <span class="token operator">=&gt;</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>output</span><span class="token punctuation">&gt;</span></span> _ <span class="token operator">=&gt;</span> #bufStrict<span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">,</span> NONCE<span class="token punctuation">)</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>output</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>account</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>acctID</span><span class="token punctuation">&gt;</span></span> ACCTID <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>acctID</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>nonce</span><span class="token punctuation">&gt;</span></span> NONCE <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>nonce</span><span class="token punctuation">&gt;</span></span>
           <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>account</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<ul>
<li><code>#setNonce ACCTID NONCE</code> takes a given account and a given nonce and update the account accordingly.</li>
</ul>
<pre><code class="language-k">     <span class="token keyword">syntax</span> KItem <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">"#setNonce"</span> <span class="token keyword">Int</span> <span class="token keyword">Int</span> <span class="token punctuation">[</span><span class="token class-name">klabel</span><span class="token punctuation">(</span>foundry_setNonce<span class="token punctuation">)</span><span class="token punctuation">]</span>
 <span class="token comment">// ----------------------------------------------------------------</span>
    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #setNonce ACCTID NONCE <span class="token operator">=&gt;</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>account</span><span class="token punctuation">&gt;</span></span>
             <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>acctID</span><span class="token punctuation">&gt;</span></span> ACCTID <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>acctID</span><span class="token punctuation">&gt;</span></span>
             <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>nonce</span><span class="token punctuation">&gt;</span></span> _ <span class="token operator">=&gt;</span> NONCE <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>nonce</span><span class="token punctuation">&gt;</span></span>
             <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>account</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<ul>
<li><code>#returnStorage ACCTID LOC</code> takes a storage value from a given account and places it on the <code>&lt;output&gt;</code> cell.</li>
</ul>
<pre><code class="language-k">    <span class="token keyword">syntax</span> KItem <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">"#returnStorage"</span> <span class="token keyword">Int</span> <span class="token keyword">Int</span> <span class="token punctuation">[</span><span class="token class-name">klabel</span><span class="token punctuation">(</span>foundry_returnStorage<span class="token punctuation">)</span><span class="token punctuation">]</span>
 <span class="token comment">// -------------------------------------------------------------------------</span>
    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #returnStorage ACCTID LOC <span class="token operator">=&gt;</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>output</span><span class="token punctuation">&gt;</span></span> _ <span class="token operator">=&gt;</span> #bufStrict<span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">,</span> #lookup<span class="token punctuation">(</span>STORAGE<span class="token punctuation">,</span> LOC<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>output</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>account</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>acctID</span><span class="token punctuation">&gt;</span></span> ACCTID <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>acctID</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>storage</span><span class="token punctuation">&gt;</span></span> STORAGE <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>storage</span><span class="token punctuation">&gt;</span></span>
           <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>account</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<ul>
<li><code>#setStorage ACCTID LOC VALUE</code> sets a given value to a given location of an account.</li>
</ul>
<pre><code class="language-k">    <span class="token keyword">syntax</span> KItem <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">"#setStorage"</span> <span class="token keyword">Int</span> <span class="token keyword">Int</span> <span class="token keyword">Int</span> <span class="token punctuation">[</span><span class="token class-name">klabel</span><span class="token punctuation">(</span>foundry_setStorage<span class="token punctuation">)</span><span class="token punctuation">]</span>
 <span class="token comment">// -----------------------------------------------------------------------</span>
    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #setStorage ACCTID LOC VALUE <span class="token operator">=&gt;</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>account</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>acctID</span><span class="token punctuation">&gt;</span></span> ACCTID <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>acctID</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>storage</span><span class="token punctuation">&gt;</span></span> STORAGE <span class="token operator">=&gt;</span> STORAGE <span class="token punctuation">[</span> LOC &lt;<span class="token operator">-</span> VALUE <span class="token punctuation">]</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>storage</span><span class="token punctuation">&gt;</span></span>
             <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>account</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<p><code>#setSymbolicStorage ACCTID</code> takes a given account and makes its storage fully symbolic.</p>
<pre><code class="language-k">     <span class="token keyword">syntax</span> KItem <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">"#setSymbolicStorage"</span> <span class="token keyword">Int</span> <span class="token punctuation">[</span><span class="token class-name">klabel</span><span class="token punctuation">(</span>foundry_setSymbolicStorage<span class="token punctuation">)</span><span class="token punctuation">]</span>
 <span class="token comment">// --------------------------------------------------------------------------------</span>
    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #setSymbolicStorage ACCTID <span class="token operator">=&gt;</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>account</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>acctID</span><span class="token punctuation">&gt;</span></span> ACCTID <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>acctID</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>storage</span><span class="token punctuation">&gt;</span></span> _ <span class="token operator">=&gt;</span> <span class="token operator">?</span>STORAGE <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>storage</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>origStorage</span><span class="token punctuation">&gt;</span></span> _ <span class="token operator">=&gt;</span> <span class="token operator">?</span>STORAGE <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>origStorage</span><span class="token punctuation">&gt;</span></span>
           <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>account</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<ul>
<li><code>#setExpectRevert</code> sets the <code>&lt;expectedRevert&gt;</code> subconfiguration with the current call depth and the expected message from <code>expectRevert</code>.</li>
</ul>
<pre><code class="language-k">    <span class="token keyword">syntax</span> KItem <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">"#setExpectRevert"</span> ByteArray <span class="token punctuation">[</span><span class="token class-name">klabel</span><span class="token punctuation">(</span>foundry_setExpectRevert<span class="token punctuation">)</span><span class="token punctuation">]</span>
 <span class="token comment">// -------------------------------------------------------------------------------</span>
    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #setExpectRevert EXPECTED <span class="token operator">=&gt;</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>callDepth</span><span class="token punctuation">&gt;</span></span> CD <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>callDepth</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>expectedRevert</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>isRevertExpected</span><span class="token punctuation">&gt;</span></span> <span class="token boolean">false</span> <span class="token operator">=&gt;</span> <span class="token boolean">true</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>isRevertExpected</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>expectedDepth</span><span class="token punctuation">&gt;</span></span> _ <span class="token operator">=&gt;</span> CD <span class="token operator">+</span><span class="token keyword">Int</span> <span class="token number">1</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>expectedDepth</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>expectedReason</span><span class="token punctuation">&gt;</span></span> _ <span class="token operator">=&gt;</span> EXPECTED <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>expectedReason</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>expectedRevert</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<ul>
<li><code>#clearExpectRevert</code> sets the <code>&lt;expectedRevert&gt;</code> subconfiguration to initial values.</li>
</ul>
<pre><code class="language-k">    <span class="token keyword">syntax</span> KItem <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">"#clearExpectRevert"</span> <span class="token punctuation">[</span><span class="token class-name">klabel</span><span class="token punctuation">(</span>foundry_clearExpectRevert<span class="token punctuation">)</span><span class="token punctuation">]</span>
 <span class="token comment">// -------------------------------------------------------------------------</span>
    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #clearExpectRevert <span class="token operator">=&gt;</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>expectedRevert</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>isRevertExpected</span><span class="token punctuation">&gt;</span></span> _ <span class="token operator">=&gt;</span> <span class="token boolean">false</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>isRevertExpected</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>expectedDepth</span><span class="token punctuation">&gt;</span></span> _ <span class="token operator">=&gt;</span> <span class="token number">0</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>expectedDepth</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>expectedReason</span><span class="token punctuation">&gt;</span></span> _ <span class="token operator">=&gt;</span> <span class="token punctuation">.</span>ByteArray <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>expectedReason</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>expectedRevert</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<ul>
<li><code>#encodeOutput</code> - will encode the output ByteArray to match the encoding of the ByteArray in <code>&lt;expectedReason&gt;</code> cell.
<ul>
<li>If the <code>revert</code> instruction  and the <code>expectRevert</code> cheat code are used with with a custom error, then <code>expectRevert</code> will store the message with the encoding <code>abi.encode(abi.encodeWithSelector(CustomError.selector, 1, 2))</code>, while the output cell will contain only the <code>abi.encodeWithSelector(CustomError.selector, 1, 2)</code>.</li>
<li>If the <code>revert</code> instruction  and the <code>expectRevert</code> cheat code are used with with a string, then <code>expectRevert</code> will store the only the encoded string, while the <code>&lt;output&gt;</code> cell will store the encoded built-in error <code>Error(string)</code>.
Since the encoding <code>abi.encode(abi.encodeWithSelector(CustomError.selector, 1, 2))</code> cannot be easily decoded when symbolic variables are used, the <code>&lt;output&gt;</code> ByteArray is encoded again when the default <code>Error(string)</code> is not used.</li>
</ul>
</li>
</ul>
<pre><code class="language-k">    <span class="token keyword">syntax</span> ByteArray <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">"#encodeOutput"</span> <span class="token string">"("</span> ByteArray <span class="token string">")"</span> <span class="token punctuation">[</span>function<span class="token punctuation">,</span> total<span class="token punctuation">,</span> <span class="token class-name">klabel</span><span class="token punctuation">(</span>foundry_encodeOutput<span class="token punctuation">)</span><span class="token punctuation">]</span>
 <span class="token comment">// ------------------------------------------------------------------------------------------------------</span>
    <span class="token keyword">rule</span> #encodeOutput<span class="token punctuation">(</span>BA<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #abiCallData<span class="token punctuation">(</span><span class="token string">"expectRevert"</span><span class="token punctuation">,</span> #bytes<span class="token punctuation">(</span>BA<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">requires</span> notBool #range<span class="token punctuation">(</span>BA<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">==</span>K Int2Bytes<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> selector<span class="token punctuation">(</span><span class="token string">"Error(string)"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> BE<span class="token punctuation">)</span>
    <span class="token keyword">rule</span> #encodeOutput<span class="token punctuation">(</span>BA<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> BA <span class="token punctuation">[</span>owise<span class="token punctuation">]</span>
</code></pre>
<ul>
<li><code>#checkRevertReason</code> will compare the contents of the <code>&lt;output&gt;</code> cell with the ByteArray from <code>&lt;expectReason&gt;</code>.</li>
</ul>
<pre><code class="language-k">    <span class="token keyword">syntax</span> KItem <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">"#checkRevertReason"</span> <span class="token punctuation">[</span><span class="token class-name">klabel</span><span class="token punctuation">(</span>foundry_checkRevertReason<span class="token punctuation">)</span><span class="token punctuation">]</span>
 <span class="token comment">// -------------------------------------------------------------------------</span>
    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #checkRevertReason <span class="token operator">=&gt;</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>statusCode</span><span class="token punctuation">&gt;</span></span> _ <span class="token operator">=&gt;</span> EVMC_SUCCESS <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>statusCode</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>output</span><span class="token punctuation">&gt;</span></span> OUT <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>output</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>expectedRevert</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>expectedReason</span><span class="token punctuation">&gt;</span></span> REASON <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>expectedReason</span><span class="token punctuation">&gt;</span></span>
           <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>expectedRevert</span><span class="token punctuation">&gt;</span></span>
      <span class="token keyword">requires</span> #matchReason<span class="token punctuation">(</span>REASON<span class="token punctuation">,</span> #encodeOutput<span class="token punctuation">(</span>OUT<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #checkRevertReason <span class="token operator">=&gt;</span> #markAsFailed <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>output</span><span class="token punctuation">&gt;</span></span> OUT <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>output</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>expectedRevert</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>expectedReason</span><span class="token punctuation">&gt;</span></span> REASON <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>expectedReason</span><span class="token punctuation">&gt;</span></span>
           <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>expectedRevert</span><span class="token punctuation">&gt;</span></span>
      <span class="token keyword">requires</span> notBool #matchReason<span class="token punctuation">(</span>REASON<span class="token punctuation">,</span> #encodeOutput<span class="token punctuation">(</span>OUT<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
<ul>
<li><code>#matchReason(REASON,OUT)</code> will check if the returned message matches the expected reason of the revert.
Will also return true if REASON is <code>.ByteArray</code>.</li>
</ul>
<pre><code class="language-k">    <span class="token keyword">syntax</span> <span class="token keyword">Bool</span> <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">"#matchReason"</span> <span class="token string">"("</span> ByteArray <span class="token string">","</span> ByteArray <span class="token string">")"</span> <span class="token punctuation">[</span>function<span class="token punctuation">,</span> <span class="token class-name">klabel</span><span class="token punctuation">(</span>foundry_matchReason<span class="token punctuation">)</span><span class="token punctuation">]</span>
 <span class="token comment">// ------------------------------------------------------------------------------------------------------</span>
    <span class="token keyword">rule</span> #matchReason<span class="token punctuation">(</span>REASON<span class="token punctuation">,</span> _<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token boolean">true</span> <span class="token keyword">requires</span> REASON <span class="token operator">==</span>K <span class="token punctuation">.</span>ByteArray
    <span class="token keyword">rule</span> #matchReason<span class="token punctuation">(</span>REASON<span class="token punctuation">,</span> OUT<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> REASON <span class="token operator">==</span>K #range<span class="token punctuation">(</span>OUT<span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> #sizeByteArray<span class="token punctuation">(</span>OUT<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token keyword">Int</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token keyword">requires</span> REASON <span class="token operator">=</span><span class="token operator">/</span><span class="token operator">=</span>K <span class="token punctuation">.</span>ByteArray
</code></pre>
<ul>
<li><code>#setExpectOpcode</code> initializes the <code>&lt;expectedOpcode&gt;</code> subconfiguration with an expected <code>Address</code>, and <code>ByteArray</code> to match the calldata.
<code>CallType</code> is used to specify what <code>CALL*</code> opcode is expected.</li>
</ul>
<pre><code class="language-k">    <span class="token keyword">syntax</span> KItem <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">"#setExpectOpcode"</span> Account ByteArray <span class="token keyword">Int</span> OpcodeType <span class="token punctuation">[</span><span class="token class-name">klabel</span><span class="token punctuation">(</span>foundry_setExpectOpcode<span class="token punctuation">)</span><span class="token punctuation">]</span>
 <span class="token comment">// ------------------------------------------------------------------------------------------------------</span>
    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #setExpectOpcode ACCT DATA VALUE OPTYPE <span class="token operator">=&gt;</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>expectedOpcode</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>isOpcodeExpected</span><span class="token punctuation">&gt;</span></span> _ <span class="token operator">=&gt;</span> <span class="token boolean">true</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>isOpcodeExpected</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>expectedAddress</span><span class="token punctuation">&gt;</span></span> _ <span class="token operator">=&gt;</span> ACCT <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>expectedAddress</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>expectedData</span><span class="token punctuation">&gt;</span></span> _ <span class="token operator">=&gt;</span> DATA <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>expectedData</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>expectedValue</span><span class="token punctuation">&gt;</span></span> _ <span class="token operator">=&gt;</span> VALUE <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>expectedValue</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>opcodeType</span><span class="token punctuation">&gt;</span></span> _ <span class="token operator">=&gt;</span> OPTYPE <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>opcodeType</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>expectedOpcode</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<ul>
<li><code>#clearExpectOpcode</code> restore the <code>&lt;expectedOpcode&gt;</code> subconfiguration to its initial values.</li>
</ul>
<pre><code class="language-k">    <span class="token keyword">syntax</span> KItem <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">"#clearExpectOpcode"</span> <span class="token punctuation">[</span><span class="token class-name">klabel</span><span class="token punctuation">(</span>foundry_clearExpectOpcode<span class="token punctuation">)</span><span class="token punctuation">]</span>
 <span class="token comment">// -------------------------------------------------------------------------</span>
    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #clearExpectOpcode <span class="token operator">=&gt;</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>expectedOpcode</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>isOpcodeExpected</span><span class="token punctuation">&gt;</span></span> _ <span class="token operator">=&gt;</span> <span class="token boolean">false</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>isOpcodeExpected</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>expectedAddress</span><span class="token punctuation">&gt;</span></span> _ <span class="token operator">=&gt;</span> <span class="token punctuation">.</span>Account <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>expectedAddress</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>expectedData</span><span class="token punctuation">&gt;</span></span> _ <span class="token operator">=&gt;</span> <span class="token punctuation">.</span>ByteArray <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>expectedData</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>opcodeType</span><span class="token punctuation">&gt;</span></span> _ <span class="token operator">=&gt;</span> <span class="token punctuation">.</span>OpcodeType <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>opcodeType</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>expectedValue</span><span class="token punctuation">&gt;</span></span> _ <span class="token operator">=&gt;</span> <span class="token number">0</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>expectedValue</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>expectedOpcode</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<ul>
<li><code>#setPrank NEWCALLER NEWORIGIN SINGLEPRANK</code> will set the <code>&lt;prank/&gt;</code> subconfiguration for the given accounts.</li>
</ul>
<pre><code class="language-k">    <span class="token keyword">syntax</span> KItem <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">"#setPrank"</span> <span class="token keyword">Int</span> Account <span class="token keyword">Bool</span> <span class="token punctuation">[</span><span class="token class-name">klabel</span><span class="token punctuation">(</span>foundry_setPrank<span class="token punctuation">)</span><span class="token punctuation">]</span>
 <span class="token comment">// ------------------------------------------------------------------------</span>
    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #setPrank NEWCALLER NEWORIGIN SINGLEPRANK <span class="token operator">=&gt;</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>callDepth</span><span class="token punctuation">&gt;</span></span> CD <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>callDepth</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>caller</span><span class="token punctuation">&gt;</span></span> CL <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>caller</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>origin</span><span class="token punctuation">&gt;</span></span> OG <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>origin</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>prank</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>prevCaller</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">.</span>Account <span class="token operator">=&gt;</span> CL <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>prevCaller</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>prevOrigin</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">.</span>Account <span class="token operator">=&gt;</span> OG <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>prevOrigin</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>newCaller</span><span class="token punctuation">&gt;</span></span> _ <span class="token operator">=&gt;</span> NEWCALLER <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>newCaller</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>newOrigin</span><span class="token punctuation">&gt;</span></span> _ <span class="token operator">=&gt;</span> NEWORIGIN <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>newOrigin</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>active</span><span class="token punctuation">&gt;</span></span> <span class="token boolean">false</span> <span class="token operator">=&gt;</span> <span class="token boolean">true</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>active</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>depth</span><span class="token punctuation">&gt;</span></span> _ <span class="token operator">=&gt;</span> CD <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>depth</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>singleCall</span><span class="token punctuation">&gt;</span></span> _ <span class="token operator">=&gt;</span> SINGLEPRANK <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>singleCall</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>prank</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<ul>
<li><code>#endPrank</code> will end the prank, restoring the previous caller and origin to the <code>&lt;caller&gt;</code> and <code>&lt;origin&gt;</code> cells in the configuration.
If the production is matched when no prank is active, it will be ignored.</li>
</ul>
<pre><code class="language-k">    <span class="token keyword">syntax</span> KItem <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">"#endPrank"</span> <span class="token punctuation">[</span><span class="token class-name">klabel</span><span class="token punctuation">(</span>foundry_endPrank<span class="token punctuation">)</span><span class="token punctuation">]</span>
 <span class="token comment">// -------------------------------------------------------</span>
    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #endPrank <span class="token operator">=&gt;</span> #clearPrank <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>caller</span><span class="token punctuation">&gt;</span></span> _ <span class="token operator">=&gt;</span> CL <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>caller</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>origin</span><span class="token punctuation">&gt;</span></span> _ <span class="token operator">=&gt;</span> OG <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>origin</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>prank</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>prevCaller</span><span class="token punctuation">&gt;</span></span> CL <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>prevCaller</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>prevOrigin</span><span class="token punctuation">&gt;</span></span> OG <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>prevOrigin</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>active</span><span class="token punctuation">&gt;</span></span> <span class="token boolean">true</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>active</span><span class="token punctuation">&gt;</span></span>
          <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>prank</span><span class="token punctuation">&gt;</span></span>

    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #endPrank <span class="token operator">=&gt;</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>prank</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>active</span><span class="token punctuation">&gt;</span></span> <span class="token boolean">false</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>active</span><span class="token punctuation">&gt;</span></span>
          <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>prank</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<ul>
<li><code>#clearPrank</code> will clear the prank subconfiguration.</li>
</ul>
<pre><code class="language-k">    <span class="token keyword">syntax</span> KItem <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">"#clearPrank"</span> <span class="token punctuation">[</span><span class="token class-name">klabel</span><span class="token punctuation">(</span>foundry_clearPrank<span class="token punctuation">)</span><span class="token punctuation">]</span>
 <span class="token comment">// -----------------------------------------------------------</span>
    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #clearPrank <span class="token operator">=&gt;</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>prank</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>prevCaller</span><span class="token punctuation">&gt;</span></span> _ <span class="token operator">=&gt;</span> <span class="token punctuation">.</span>Account <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>prevCaller</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>prevOrigin</span><span class="token punctuation">&gt;</span></span> _ <span class="token operator">=&gt;</span> <span class="token punctuation">.</span>Account <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>prevOrigin</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>newCaller</span><span class="token punctuation">&gt;</span></span> _ <span class="token operator">=&gt;</span> <span class="token punctuation">.</span>Account <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>newCaller</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>newOrigin</span><span class="token punctuation">&gt;</span></span> _ <span class="token operator">=&gt;</span> <span class="token punctuation">.</span>Account <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>newOrigin</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>active</span><span class="token punctuation">&gt;</span></span> _ <span class="token operator">=&gt;</span> <span class="token boolean">false</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>active</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>depth</span><span class="token punctuation">&gt;</span></span> _ <span class="token operator">=&gt;</span> <span class="token number">0</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>depth</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>singleCall</span><span class="token punctuation">&gt;</span></span> _ <span class="token operator">=&gt;</span> <span class="token boolean">false</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>singleCall</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>prank</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<pre><code class="language-k">    <span class="token keyword">syntax</span> ByteArray <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #sign <span class="token punctuation">(</span> ByteArray <span class="token punctuation">,</span> ByteArray <span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">,</span><span class="token class-name">klabel</span><span class="token punctuation">(</span>foundry_sign<span class="token punctuation">)</span><span class="token punctuation">]</span>
 <span class="token comment">// ------------------------------------------------------------------------------------</span>
    <span class="token keyword">rule</span> #sign<span class="token punctuation">(</span>BA1<span class="token punctuation">,</span> BA2<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #parseByteStack<span class="token punctuation">(</span>ECDSASign<span class="token punctuation">(</span>#unparseByteStack<span class="token punctuation">(</span>BA1<span class="token punctuation">)</span><span class="token punctuation">,</span> #unparseByteStack<span class="token punctuation">(</span>BA2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>concrete<span class="token punctuation">]</span>
</code></pre>
<ul>
<li><code>#setExpectEmit</code> will initialize the <code>&lt;expectEmit/&gt;</code> subconfiguration, based on the arguments provided with the <code>expectEmit</code> cheat code.</li>
</ul>
<pre><code class="language-k">    <span class="token keyword">syntax</span> KItem <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">"#setExpectEmit"</span> <span class="token keyword">Bool</span> <span class="token keyword">Bool</span> <span class="token keyword">Bool</span> <span class="token keyword">Bool</span> Account <span class="token punctuation">[</span><span class="token class-name">klabel</span><span class="token punctuation">(</span>foundry_setExpectEmit<span class="token punctuation">)</span><span class="token punctuation">]</span>
 <span class="token comment">// ---------------------------------------------------------------------------------------------</span>
    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #setExpectEmit T1 T2 T3 CHECKDATA ACCT <span class="token operator">=&gt;</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>expectEmit</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>recordEvent</span><span class="token punctuation">&gt;</span></span> _ <span class="token operator">=&gt;</span> <span class="token boolean">true</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>recordEvent</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>isEventExpected</span><span class="token punctuation">&gt;</span></span> _ <span class="token operator">=&gt;</span> <span class="token boolean">false</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>isEventExpected</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>checkedTopics</span><span class="token punctuation">&gt;</span></span> _ <span class="token operator">=&gt;</span> ListItem<span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> ListItem<span class="token punctuation">(</span>T1<span class="token punctuation">)</span> ListItem<span class="token punctuation">(</span>T2<span class="token punctuation">)</span> ListItem<span class="token punctuation">(</span>T3<span class="token punctuation">)</span> <span class="token punctuation">.</span>List <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>checkedTopics</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>checkedData</span><span class="token punctuation">&gt;</span></span> _ <span class="token operator">=&gt;</span> CHECKDATA <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>checkedData</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>expectedEventAddress</span><span class="token punctuation">&gt;</span></span> _ <span class="token operator">=&gt;</span> ACCT <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>expectedEventAddress</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>expectEmit</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<ul>
<li><code>#clearExpectEmit</code> is used to clear the <code>&lt;expectEmit/&gt;</code> subconfiguration and restore initial values.</li>
</ul>
<pre><code class="language-k">    <span class="token keyword">syntax</span> KItem <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">"#clearExpectEmit"</span> <span class="token punctuation">[</span><span class="token class-name">klabel</span><span class="token punctuation">(</span>foundry_clearExpectEmit<span class="token punctuation">)</span><span class="token punctuation">]</span>
 <span class="token comment">// ---------------------------------------------------------------------</span>
    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #clearExpectEmit <span class="token operator">=&gt;</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>expectEmit</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>recordEvent</span><span class="token punctuation">&gt;</span></span> _ <span class="token operator">=&gt;</span> <span class="token boolean">false</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>recordEvent</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>isEventExpected</span><span class="token punctuation">&gt;</span></span> _ <span class="token operator">=&gt;</span> <span class="token boolean">false</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>isEventExpected</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>checkedTopics</span><span class="token punctuation">&gt;</span></span> _ <span class="token operator">=&gt;</span> <span class="token punctuation">.</span>List <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>checkedTopics</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>checkedData</span><span class="token punctuation">&gt;</span></span> _ <span class="token operator">=&gt;</span> <span class="token boolean">false</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>checkedData</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>expectedEventAddress</span><span class="token punctuation">&gt;</span></span> _ <span class="token operator">=&gt;</span> <span class="token punctuation">.</span>Account <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>expectedEventAddress</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>expectEmit</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<ul>
<li><code>#checkTopics</code> and <code>#checkTopic</code> are functions that compare the <code>TOPICS</code> of the expected <code>Event</code> with those of the currently emitted <code>Event</code>.</li>
</ul>
<pre><code class="language-k">    <span class="token keyword">syntax</span> <span class="token keyword">Bool</span> <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">"#checkTopic"</span> <span class="token string">"("</span> <span class="token keyword">Bool</span> <span class="token string">","</span> <span class="token keyword">Int</span> <span class="token string">","</span> <span class="token keyword">Int</span> <span class="token string">")"</span> <span class="token punctuation">[</span>function<span class="token punctuation">,</span> <span class="token class-name">klabel</span><span class="token punctuation">(</span>foundry_checkTopic<span class="token punctuation">)</span><span class="token punctuation">]</span>
                  <span class="token operator">|</span> <span class="token string">"#checkTopics"</span> <span class="token string">"("</span> List <span class="token string">","</span> List <span class="token string">","</span> List <span class="token string">")"</span> <span class="token punctuation">[</span>function<span class="token punctuation">,</span> <span class="token class-name">klabel</span><span class="token punctuation">(</span>foundry_checkTopics<span class="token punctuation">)</span><span class="token punctuation">]</span>
 <span class="token comment">// -----------------------------------------------------------------------------------------------------</span>
    <span class="token keyword">rule</span> #checkTopic<span class="token punctuation">(</span>CHECK<span class="token punctuation">,</span> V1<span class="token punctuation">,</span> V2<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>notBool CHECK<span class="token punctuation">)</span> orBool <span class="token punctuation">(</span>V1 <span class="token operator">==</span><span class="token keyword">Int</span> V2<span class="token punctuation">)</span>

    <span class="token keyword">rule</span> #checkTopics<span class="token punctuation">(</span><span class="token punctuation">.</span>List<span class="token punctuation">,</span> _<span class="token punctuation">,</span> _<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token boolean">true</span>
    <span class="token keyword">rule</span> #checkTopics<span class="token punctuation">(</span>ListItem<span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">,</span> L1<span class="token punctuation">,</span> L2<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token boolean">false</span> <span class="token keyword">requires</span> L1 <span class="token operator">==</span>K <span class="token punctuation">.</span>List orBool L2 <span class="token operator">==</span>K <span class="token punctuation">.</span>List
    <span class="token keyword">rule</span> #checkTopics<span class="token punctuation">(</span>ListItem<span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">,</span> L1<span class="token punctuation">,</span> L2<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token boolean">true</span> <span class="token keyword">requires</span> L1 <span class="token operator">==</span>K <span class="token punctuation">.</span>List orBool L2 <span class="token operator">==</span>K <span class="token punctuation">.</span>List
    <span class="token keyword">rule</span> #checkTopics<span class="token punctuation">(</span>ListItem<span class="token punctuation">(</span>CHECK<span class="token punctuation">)</span> CHECKS<span class="token punctuation">,</span> ListItem<span class="token punctuation">(</span>V1<span class="token punctuation">)</span> L1<span class="token punctuation">,</span> ListItem<span class="token punctuation">(</span>V2<span class="token punctuation">)</span> L2<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #checkTopic<span class="token punctuation">(</span>CHECK<span class="token punctuation">,</span> V1<span class="token punctuation">,</span> V2<span class="token punctuation">)</span> andBool #checkTopics<span class="token punctuation">(</span>CHECKS<span class="token punctuation">,</span> L1<span class="token punctuation">,</span> L2<span class="token punctuation">)</span>
</code></pre>
<ul>
<li><code>#addAddressToWhitelist</code> enables the whitelist restriction for calls and adds an address to the whitelist.</li>
</ul>
<pre><code class="language-k">    <span class="token keyword">syntax</span> KItem <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">"#addAddressToWhitelist"</span> <span class="token keyword">Int</span> <span class="token punctuation">[</span><span class="token class-name">klabel</span><span class="token punctuation">(</span>foundry_addAddressToWhitelist<span class="token punctuation">)</span><span class="token punctuation">]</span>
 <span class="token comment">// -------------------------------------------------------------------------------------</span>
    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #addAddressToWhitelist ACCT <span class="token operator">=&gt;</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>whitelist</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>isCallWhitelistActive</span><span class="token punctuation">&gt;</span></span> _ <span class="token operator">=&gt;</span> <span class="token boolean">true</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>isCallWhitelistActive</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>addressSet</span><span class="token punctuation">&gt;</span></span>  WLIST <span class="token operator">=&gt;</span> WLIST SetItem<span class="token punctuation">(</span>ACCT<span class="token punctuation">)</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>addressSet</span><span class="token punctuation">&gt;</span></span>
          <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>whitelist</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<ul>
<li><code>#addStorageSlotToWhitelist</code> enables the whitelist restriction for storage chagnes and adds a <code>StorageSlot</code> item to the whitelist.</li>
</ul>
<pre><code class="language-k">    <span class="token keyword">syntax</span> KItem <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">"#addStorageSlotToWhitelist"</span> StorageSlot <span class="token punctuation">[</span><span class="token class-name">klabel</span><span class="token punctuation">(</span>foundry_addStorageSlotToWhitelist<span class="token punctuation">)</span><span class="token punctuation">]</span>
 <span class="token comment">// -----------------------------------------------------------------------------------------------------</span>
    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #addStorageSlotToWhitelist SLOT <span class="token operator">=&gt;</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>whitelist</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>isStorageWhitelistActive</span><span class="token punctuation">&gt;</span></span> _ <span class="token operator">=&gt;</span> <span class="token boolean">true</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>isStorageWhitelistActive</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>storageSlotSet</span><span class="token punctuation">&gt;</span></span> WLIST <span class="token operator">=&gt;</span> WLIST SetItem<span class="token punctuation">(</span>SLOT<span class="token punctuation">)</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>storageSlotSet</span><span class="token punctuation">&gt;</span></span>
          <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>whitelist</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<ul>
<li>selectors for cheat code functions.</li>
</ul>
<pre><code class="language-k">    <span class="token keyword">rule</span> <span class="token punctuation">(</span> selector <span class="token punctuation">(</span> <span class="token string">"assume(bool)"</span> <span class="token punctuation">)</span>                             <span class="token operator">=&gt;</span> <span class="token number">1281615202</span> <span class="token punctuation">)</span>
    <span class="token keyword">rule</span> <span class="token punctuation">(</span> selector <span class="token punctuation">(</span> <span class="token string">"deal(address,uint256)"</span> <span class="token punctuation">)</span>                    <span class="token operator">=&gt;</span> <span class="token number">3364511341</span> <span class="token punctuation">)</span>
    <span class="token keyword">rule</span> <span class="token punctuation">(</span> selector <span class="token punctuation">(</span> <span class="token string">"etch(address,bytes)"</span> <span class="token punctuation">)</span>                      <span class="token operator">=&gt;</span> <span class="token number">3033974658</span> <span class="token punctuation">)</span>
    <span class="token keyword">rule</span> <span class="token punctuation">(</span> selector <span class="token punctuation">(</span> <span class="token string">"warp(uint256)"</span> <span class="token punctuation">)</span>                            <span class="token operator">=&gt;</span> <span class="token number">3856056066</span> <span class="token punctuation">)</span>
    <span class="token keyword">rule</span> <span class="token punctuation">(</span> selector <span class="token punctuation">(</span> <span class="token string">"roll(uint256)"</span> <span class="token punctuation">)</span>                            <span class="token operator">=&gt;</span> <span class="token number">528174896</span>  <span class="token punctuation">)</span>
    <span class="token keyword">rule</span> <span class="token punctuation">(</span> selector <span class="token punctuation">(</span> <span class="token string">"fee(uint256)"</span> <span class="token punctuation">)</span>                             <span class="token operator">=&gt;</span> <span class="token number">968063664</span>  <span class="token punctuation">)</span>
    <span class="token keyword">rule</span> <span class="token punctuation">(</span> selector <span class="token punctuation">(</span> <span class="token string">"chainId(uint256)"</span> <span class="token punctuation">)</span>                         <span class="token operator">=&gt;</span> <span class="token number">1078582738</span> <span class="token punctuation">)</span>
    <span class="token keyword">rule</span> <span class="token punctuation">(</span> selector <span class="token punctuation">(</span> <span class="token string">"coinbase(address)"</span> <span class="token punctuation">)</span>                        <span class="token operator">=&gt;</span> <span class="token number">4282924116</span> <span class="token punctuation">)</span>
    <span class="token keyword">rule</span> <span class="token punctuation">(</span> selector <span class="token punctuation">(</span> <span class="token string">"label(address,string)"</span> <span class="token punctuation">)</span>                    <span class="token operator">=&gt;</span> <span class="token number">3327641368</span> <span class="token punctuation">)</span>
    <span class="token keyword">rule</span> <span class="token punctuation">(</span> selector <span class="token punctuation">(</span> <span class="token string">"getNonce(address)"</span> <span class="token punctuation">)</span>                        <span class="token operator">=&gt;</span> <span class="token number">755185067</span>  <span class="token punctuation">)</span>
    <span class="token keyword">rule</span> <span class="token punctuation">(</span> selector <span class="token punctuation">(</span> <span class="token string">"addr(uint256)"</span> <span class="token punctuation">)</span>                            <span class="token operator">=&gt;</span> <span class="token number">4288775753</span> <span class="token punctuation">)</span>
    <span class="token keyword">rule</span> <span class="token punctuation">(</span> selector <span class="token punctuation">(</span> <span class="token string">"load(address,bytes32)"</span> <span class="token punctuation">)</span>                    <span class="token operator">=&gt;</span> <span class="token number">1719639408</span> <span class="token punctuation">)</span>
    <span class="token keyword">rule</span> <span class="token punctuation">(</span> selector <span class="token punctuation">(</span> <span class="token string">"store(address,bytes32,bytes32)"</span> <span class="token punctuation">)</span>           <span class="token operator">=&gt;</span> <span class="token number">1892290747</span> <span class="token punctuation">)</span>
    <span class="token keyword">rule</span> <span class="token punctuation">(</span> selector <span class="token punctuation">(</span> <span class="token string">"setNonce(address,uint64)"</span> <span class="token punctuation">)</span>                 <span class="token operator">=&gt;</span> <span class="token number">4175530839</span> <span class="token punctuation">)</span>
    <span class="token keyword">rule</span> <span class="token punctuation">(</span> selector <span class="token punctuation">(</span> <span class="token string">"expectRevert()"</span> <span class="token punctuation">)</span>                           <span class="token operator">=&gt;</span> <span class="token number">4102309908</span> <span class="token punctuation">)</span>
    <span class="token keyword">rule</span> <span class="token punctuation">(</span> selector <span class="token punctuation">(</span> <span class="token string">"expectRevert(bytes)"</span> <span class="token punctuation">)</span>                      <span class="token operator">=&gt;</span> <span class="token number">4069379763</span> <span class="token punctuation">)</span>
    <span class="token keyword">rule</span> <span class="token punctuation">(</span> selector <span class="token punctuation">(</span> <span class="token string">"startPrank(address)"</span> <span class="token punctuation">)</span>                      <span class="token operator">=&gt;</span> <span class="token number">105151830</span>  <span class="token punctuation">)</span>
    <span class="token keyword">rule</span> <span class="token punctuation">(</span> selector <span class="token punctuation">(</span> <span class="token string">"startPrank(address,address)"</span> <span class="token punctuation">)</span>              <span class="token operator">=&gt;</span> <span class="token number">1169514616</span> <span class="token punctuation">)</span>
    <span class="token keyword">rule</span> <span class="token punctuation">(</span> selector <span class="token punctuation">(</span> <span class="token string">"stopPrank()"</span> <span class="token punctuation">)</span>                              <span class="token operator">=&gt;</span> <span class="token number">2428830011</span> <span class="token punctuation">)</span>
    <span class="token keyword">rule</span> <span class="token punctuation">(</span> selector <span class="token punctuation">(</span> <span class="token string">"expectStaticCall(address,bytes)"</span> <span class="token punctuation">)</span>          <span class="token operator">=&gt;</span> <span class="token number">2232945516</span> <span class="token punctuation">)</span>
    <span class="token keyword">rule</span> <span class="token punctuation">(</span> selector <span class="token punctuation">(</span> <span class="token string">"expectDelegateCall(address,bytes)"</span> <span class="token punctuation">)</span>        <span class="token operator">=&gt;</span> <span class="token number">1030406631</span> <span class="token punctuation">)</span>
    <span class="token keyword">rule</span> <span class="token punctuation">(</span> selector <span class="token punctuation">(</span> <span class="token string">"expectRegularCall(address,uint256,bytes)"</span> <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token number">1973496647</span> <span class="token punctuation">)</span>
    <span class="token keyword">rule</span> <span class="token punctuation">(</span> selector <span class="token punctuation">(</span> <span class="token string">"expectCreate(address,uint256,bytes)"</span> <span class="token punctuation">)</span>      <span class="token operator">=&gt;</span> <span class="token number">658968394</span>  <span class="token punctuation">)</span>
    <span class="token keyword">rule</span> <span class="token punctuation">(</span> selector <span class="token punctuation">(</span> <span class="token string">"expectCreate2(address,uint256,bytes)"</span> <span class="token punctuation">)</span>     <span class="token operator">=&gt;</span> <span class="token number">3854582462</span> <span class="token punctuation">)</span>
    <span class="token keyword">rule</span> <span class="token punctuation">(</span> selector <span class="token punctuation">(</span> <span class="token string">"expectEmit(bool,bool,bool,bool)"</span> <span class="token punctuation">)</span>          <span class="token operator">=&gt;</span> <span class="token number">1226622914</span> <span class="token punctuation">)</span>
    <span class="token keyword">rule</span> <span class="token punctuation">(</span> selector <span class="token punctuation">(</span> <span class="token string">"expectEmit(bool,bool,bool,bool,address)"</span> <span class="token punctuation">)</span>  <span class="token operator">=&gt;</span> <span class="token number">2176505587</span> <span class="token punctuation">)</span>
    <span class="token keyword">rule</span> <span class="token punctuation">(</span> selector <span class="token punctuation">(</span> <span class="token string">"sign(uint256,bytes32)"</span> <span class="token punctuation">)</span>                    <span class="token operator">=&gt;</span> <span class="token number">3812747940</span> <span class="token punctuation">)</span>
    <span class="token keyword">rule</span> <span class="token punctuation">(</span> selector <span class="token punctuation">(</span> <span class="token string">"symbolicStorage(address)"</span> <span class="token punctuation">)</span>                 <span class="token operator">=&gt;</span> <span class="token number">769677742</span>  <span class="token punctuation">)</span>
    <span class="token keyword">rule</span> <span class="token punctuation">(</span> selector <span class="token punctuation">(</span> <span class="token string">"prank(address)"</span> <span class="token punctuation">)</span>                           <span class="token operator">=&gt;</span> <span class="token number">3395723175</span> <span class="token punctuation">)</span>
    <span class="token keyword">rule</span> <span class="token punctuation">(</span> selector <span class="token punctuation">(</span> <span class="token string">"prank(address,address)"</span> <span class="token punctuation">)</span>                   <span class="token operator">=&gt;</span> <span class="token number">1206193358</span> <span class="token punctuation">)</span>
    <span class="token keyword">rule</span> <span class="token punctuation">(</span> selector <span class="token punctuation">(</span> <span class="token string">"allowCallsToAddress(address)"</span> <span class="token punctuation">)</span>             <span class="token operator">=&gt;</span> <span class="token number">1850795572</span> <span class="token punctuation">)</span>
    <span class="token keyword">rule</span> <span class="token punctuation">(</span> selector <span class="token punctuation">(</span> <span class="token string">"allowChangesToStorage(address,uint256)"</span> <span class="token punctuation">)</span>   <span class="token operator">=&gt;</span> <span class="token number">4207417100</span> <span class="token punctuation">)</span>
</code></pre>
<ul>
<li>selectors for unimplemented cheat code functions.</li>
</ul>
<pre><code class="language-k">    <span class="token keyword">rule</span> selector <span class="token punctuation">(</span> <span class="token string">"expectRegularCall(address,bytes)"</span> <span class="token punctuation">)</span>        <span class="token operator">=&gt;</span> <span class="token number">3178868520</span>
    <span class="token keyword">rule</span> selector <span class="token punctuation">(</span> <span class="token string">"expectNoCall()"</span> <span class="token punctuation">)</span>                          <span class="token operator">=&gt;</span> <span class="token number">3861374088</span>
    <span class="token keyword">rule</span> selector <span class="token punctuation">(</span> <span class="token string">"ffi(string[])"</span> <span class="token punctuation">)</span>                           <span class="token operator">=&gt;</span> <span class="token number">2299921511</span>
    <span class="token keyword">rule</span> selector <span class="token punctuation">(</span> <span class="token string">"setEnv(string,string)"</span> <span class="token punctuation">)</span>                   <span class="token operator">=&gt;</span> <span class="token number">1029252078</span>
    <span class="token keyword">rule</span> selector <span class="token punctuation">(</span> <span class="token string">"envBool(string)"</span> <span class="token punctuation">)</span>                         <span class="token operator">=&gt;</span> <span class="token number">2127686781</span>
    <span class="token keyword">rule</span> selector <span class="token punctuation">(</span> <span class="token string">"envUint(string)"</span> <span class="token punctuation">)</span>                         <span class="token operator">=&gt;</span> <span class="token number">3247934751</span>
    <span class="token keyword">rule</span> selector <span class="token punctuation">(</span> <span class="token string">"envInt(string)"</span> <span class="token punctuation">)</span>                          <span class="token operator">=&gt;</span> <span class="token number">2301234273</span>
    <span class="token keyword">rule</span> selector <span class="token punctuation">(</span> <span class="token string">"envAddress(string)"</span> <span class="token punctuation">)</span>                      <span class="token operator">=&gt;</span> <span class="token number">890066623</span>
    <span class="token keyword">rule</span> selector <span class="token punctuation">(</span> <span class="token string">"envBytes32(string)"</span> <span class="token punctuation">)</span>                      <span class="token operator">=&gt;</span> <span class="token number">2543095874</span>
    <span class="token keyword">rule</span> selector <span class="token punctuation">(</span> <span class="token string">"envString(string)"</span> <span class="token punctuation">)</span>                       <span class="token operator">=&gt;</span> <span class="token number">4168600345</span>
    <span class="token keyword">rule</span> selector <span class="token punctuation">(</span> <span class="token string">"envBytes(string)"</span> <span class="token punctuation">)</span>                        <span class="token operator">=&gt;</span> <span class="token number">1299951366</span>
    <span class="token keyword">rule</span> selector <span class="token punctuation">(</span> <span class="token string">"envBool(string,string)"</span> <span class="token punctuation">)</span>                  <span class="token operator">=&gt;</span> <span class="token number">2863521455</span>
    <span class="token keyword">rule</span> selector <span class="token punctuation">(</span> <span class="token string">"envUint(string,string)"</span> <span class="token punctuation">)</span>                  <span class="token operator">=&gt;</span> <span class="token number">4091461785</span>
    <span class="token keyword">rule</span> selector <span class="token punctuation">(</span> <span class="token string">"envInt(string,string)"</span> <span class="token punctuation">)</span>                   <span class="token operator">=&gt;</span> <span class="token number">1108873552</span>
    <span class="token keyword">rule</span> selector <span class="token punctuation">(</span> <span class="token string">"envAddress(string,string)"</span> <span class="token punctuation">)</span>               <span class="token operator">=&gt;</span> <span class="token number">2905717242</span>
    <span class="token keyword">rule</span> selector <span class="token punctuation">(</span> <span class="token string">"envBytes32(string,string)"</span> <span class="token punctuation">)</span>               <span class="token operator">=&gt;</span> <span class="token number">1525821889</span>
    <span class="token keyword">rule</span> selector <span class="token punctuation">(</span> <span class="token string">"envString(string,string)"</span> <span class="token punctuation">)</span>                <span class="token operator">=&gt;</span> <span class="token number">347089865</span>
    <span class="token keyword">rule</span> selector <span class="token punctuation">(</span> <span class="token string">"envBytes(string,string)"</span> <span class="token punctuation">)</span>                 <span class="token operator">=&gt;</span> <span class="token number">3720504603</span>
    <span class="token keyword">rule</span> selector <span class="token punctuation">(</span> <span class="token string">"expectRevert(bytes4)"</span> <span class="token punctuation">)</span>                    <span class="token operator">=&gt;</span> <span class="token number">3273568480</span>
    <span class="token keyword">rule</span> selector <span class="token punctuation">(</span> <span class="token string">"record()"</span> <span class="token punctuation">)</span>                                <span class="token operator">=&gt;</span> <span class="token number">644673801</span>
    <span class="token keyword">rule</span> selector <span class="token punctuation">(</span> <span class="token string">"accesses(address)"</span> <span class="token punctuation">)</span>                       <span class="token operator">=&gt;</span> <span class="token number">1706857601</span>
    <span class="token keyword">rule</span> selector <span class="token punctuation">(</span> <span class="token string">"mockCall(address,bytes calldata,bytes)"</span> <span class="token punctuation">)</span>  <span class="token operator">=&gt;</span> <span class="token number">378193464</span>
    <span class="token keyword">rule</span> selector <span class="token punctuation">(</span> <span class="token string">"mockCall(address,uint256,bytes,bytes)"</span> <span class="token punctuation">)</span>   <span class="token operator">=&gt;</span> <span class="token number">2168494993</span>
    <span class="token keyword">rule</span> selector <span class="token punctuation">(</span> <span class="token string">"clearMockedCalls()"</span> <span class="token punctuation">)</span>                      <span class="token operator">=&gt;</span> <span class="token number">1071599125</span>
    <span class="token keyword">rule</span> selector <span class="token punctuation">(</span> <span class="token string">"expectCall(address,bytes)"</span> <span class="token punctuation">)</span>               <span class="token operator">=&gt;</span> <span class="token number">3177903156</span>
    <span class="token keyword">rule</span> selector <span class="token punctuation">(</span> <span class="token string">"expectCall(address,uint256,bytes)"</span> <span class="token punctuation">)</span>       <span class="token operator">=&gt;</span> <span class="token number">4077681571</span>
    <span class="token keyword">rule</span> selector <span class="token punctuation">(</span> <span class="token string">"getCode(string)"</span> <span class="token punctuation">)</span>                         <span class="token operator">=&gt;</span> <span class="token number">2367473957</span>
    <span class="token keyword">rule</span> selector <span class="token punctuation">(</span> <span class="token string">"broadcast()"</span> <span class="token punctuation">)</span>                             <span class="token operator">=&gt;</span> <span class="token number">2949218368</span>
    <span class="token keyword">rule</span> selector <span class="token punctuation">(</span> <span class="token string">"broadcast(address)"</span> <span class="token punctuation">)</span>                      <span class="token operator">=&gt;</span> <span class="token number">3868601563</span>
    <span class="token keyword">rule</span> selector <span class="token punctuation">(</span> <span class="token string">"startBroadcast()"</span> <span class="token punctuation">)</span>                        <span class="token operator">=&gt;</span> <span class="token number">2142579071</span>
    <span class="token keyword">rule</span> selector <span class="token punctuation">(</span> <span class="token string">"startBroadcast(address)"</span> <span class="token punctuation">)</span>                 <span class="token operator">=&gt;</span> <span class="token number">2146183821</span>
    <span class="token keyword">rule</span> selector <span class="token punctuation">(</span> <span class="token string">"stopBroadcast()"</span> <span class="token punctuation">)</span>                         <span class="token operator">=&gt;</span> <span class="token number">1995103542</span>
    <span class="token keyword">rule</span> selector <span class="token punctuation">(</span> <span class="token string">"readFile(string)"</span> <span class="token punctuation">)</span>                        <span class="token operator">=&gt;</span> <span class="token number">1626979089</span>
    <span class="token keyword">rule</span> selector <span class="token punctuation">(</span> <span class="token string">"readLine(string)"</span> <span class="token punctuation">)</span>                        <span class="token operator">=&gt;</span> <span class="token number">1895126824</span>
    <span class="token keyword">rule</span> selector <span class="token punctuation">(</span> <span class="token string">"writeFile(string,string)"</span> <span class="token punctuation">)</span>                <span class="token operator">=&gt;</span> <span class="token number">2306738839</span>
    <span class="token keyword">rule</span> selector <span class="token punctuation">(</span> <span class="token string">"writeLine(string,string)"</span> <span class="token punctuation">)</span>                <span class="token operator">=&gt;</span> <span class="token number">1637714303</span>
    <span class="token keyword">rule</span> selector <span class="token punctuation">(</span> <span class="token string">"closeFile(string)"</span> <span class="token punctuation">)</span>                       <span class="token operator">=&gt;</span> <span class="token number">1220748319</span>
    <span class="token keyword">rule</span> selector <span class="token punctuation">(</span> <span class="token string">"removeFile(string)"</span> <span class="token punctuation">)</span>                      <span class="token operator">=&gt;</span> <span class="token number">4054835277</span>
    <span class="token keyword">rule</span> selector <span class="token punctuation">(</span> <span class="token string">"toString(address)"</span> <span class="token punctuation">)</span>                       <span class="token operator">=&gt;</span> <span class="token number">1456103998</span>
    <span class="token keyword">rule</span> selector <span class="token punctuation">(</span> <span class="token string">"toString(bytes)"</span> <span class="token punctuation">)</span>                         <span class="token operator">=&gt;</span> <span class="token number">1907020045</span>
    <span class="token keyword">rule</span> selector <span class="token punctuation">(</span> <span class="token string">"toString(bytes32)"</span> <span class="token punctuation">)</span>                       <span class="token operator">=&gt;</span> <span class="token number">2971277800</span>
    <span class="token keyword">rule</span> selector <span class="token punctuation">(</span> <span class="token string">"toString(bool)"</span> <span class="token punctuation">)</span>                          <span class="token operator">=&gt;</span> <span class="token number">1910302682</span>
    <span class="token keyword">rule</span> selector <span class="token punctuation">(</span> <span class="token string">"toString(uint256)"</span> <span class="token punctuation">)</span>                       <span class="token operator">=&gt;</span> <span class="token number">1761649582</span>
    <span class="token keyword">rule</span> selector <span class="token punctuation">(</span> <span class="token string">"toString(int256)"</span> <span class="token punctuation">)</span>                        <span class="token operator">=&gt;</span> <span class="token number">2736964622</span>
    <span class="token keyword">rule</span> selector <span class="token punctuation">(</span> <span class="token string">"recordLogs()"</span> <span class="token punctuation">)</span>                            <span class="token operator">=&gt;</span> <span class="token number">1101999954</span>
    <span class="token keyword">rule</span> selector <span class="token punctuation">(</span> <span class="token string">"getRecordedLogs()"</span> <span class="token punctuation">)</span>                       <span class="token operator">=&gt;</span> <span class="token number">420828068</span>
    <span class="token keyword">rule</span> selector <span class="token punctuation">(</span> <span class="token string">"snapshot()"</span> <span class="token punctuation">)</span>                              <span class="token operator">=&gt;</span> <span class="token number">2534502746</span>
    <span class="token keyword">rule</span> selector <span class="token punctuation">(</span> <span class="token string">"revertTo(uint256)"</span> <span class="token punctuation">)</span>                       <span class="token operator">=&gt;</span> <span class="token number">1155002532</span>
    <span class="token keyword">rule</span> selector <span class="token punctuation">(</span> <span class="token string">"createFork(string,uint256)"</span> <span class="token punctuation">)</span>              <span class="token operator">=&gt;</span> <span class="token number">1805892139</span>
    <span class="token keyword">rule</span> selector <span class="token punctuation">(</span> <span class="token string">"createFork(string)"</span> <span class="token punctuation">)</span>                      <span class="token operator">=&gt;</span> <span class="token number">834286744</span>
    <span class="token keyword">rule</span> selector <span class="token punctuation">(</span> <span class="token string">"createSelectFork(string,uint256)"</span> <span class="token punctuation">)</span>        <span class="token operator">=&gt;</span> <span class="token number">1911440973</span>
    <span class="token keyword">rule</span> selector <span class="token punctuation">(</span> <span class="token string">"createSelectFork(string)"</span> <span class="token punctuation">)</span>                <span class="token operator">=&gt;</span> <span class="token number">2556952628</span>
    <span class="token keyword">rule</span> selector <span class="token punctuation">(</span> <span class="token string">"selectFork(uint256)"</span> <span class="token punctuation">)</span>                     <span class="token operator">=&gt;</span> <span class="token number">2663344167</span>
    <span class="token keyword">rule</span> selector <span class="token punctuation">(</span> <span class="token string">"activeFork()"</span> <span class="token punctuation">)</span>                            <span class="token operator">=&gt;</span> <span class="token number">789593890</span>
    <span class="token keyword">rule</span> selector <span class="token punctuation">(</span> <span class="token string">"rollFork(uint256)"</span> <span class="token punctuation">)</span>                       <span class="token operator">=&gt;</span> <span class="token number">3652973473</span>
    <span class="token keyword">rule</span> selector <span class="token punctuation">(</span> <span class="token string">"rollFork(uint256,uint256)"</span> <span class="token punctuation">)</span>               <span class="token operator">=&gt;</span> <span class="token number">3612115876</span>
    <span class="token keyword">rule</span> selector <span class="token punctuation">(</span> <span class="token string">"rpcUrl(string)"</span> <span class="token punctuation">)</span>                          <span class="token operator">=&gt;</span> <span class="token number">2539285737</span>
    <span class="token keyword">rule</span> selector <span class="token punctuation">(</span> <span class="token string">"rpcUrls()"</span> <span class="token punctuation">)</span>                               <span class="token operator">=&gt;</span> <span class="token number">2824504344</span>
    <span class="token keyword">rule</span> selector <span class="token punctuation">(</span> <span class="token string">"deriveKey(string,uint32)"</span> <span class="token punctuation">)</span>                <span class="token operator">=&gt;</span> <span class="token number">1646872971</span>
</code></pre>
<ul>
<li>selector for Solidity built-in Error</li>
</ul>
<pre><code class="language-k">    <span class="token keyword">rule</span> <span class="token punctuation">(</span> selector <span class="token punctuation">(</span> <span class="token string">"Error(string)"</span> <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token number">147028384</span> <span class="token punctuation">)</span>
</code></pre>
<pre><code class="language-k"><span class="token keyword">endmodule</span>
</code></pre>
</body></html></div>
        </main>

        <!-- Page ToC -->
        <div class="col-12 col-md-3 col-xl-2 py-md-3 bd-sidebar page-toc mb-3">
          
<div>
<details style="padding:0.25rem 0;;padding-left: 0px;" open>
            <summary class="bd-toc-link-wrapper">
              <a href="#foundry-specifications" class="bd-toc-link">Foundry Specifications</a>
              </summary>
            <div>
              <div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#example-usage"
                class="bd-toc-link"
                style="padding-left: 8px;;"
              >
                Example Usage
              </a></div><details style="padding:0.25rem 0;;padding-left: 8px;" open>
            <summary class="bd-toc-link-wrapper">
              <a href="#foundry-module-for-kevm" class="bd-toc-link">Foundry Module for KEVM</a>
              </summary>
            <div>
              <div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#foundry-success-predicate"
                class="bd-toc-link"
                style="padding-left: 16px;;"
              >
                Foundry Success Predicate
              </a></div><details style="padding:0.25rem 0;;padding-left: 16px;" open>
            <summary class="bd-toc-link-wrapper">
              <a href="#foundry-cheat-codes" class="bd-toc-link">Foundry Cheat Codes</a>
              </summary>
            <div>
              <div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#structure-of-execution"
                class="bd-toc-link"
                style="padding-left: 24px;;"
              >
                Structure of execution
              </a></div><div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#assume---insert-a-condition"
                class="bd-toc-link"
                style="padding-left: 24px;;"
              >
                <code>assume</code> - Insert a condition
              </a></div><div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#deal---set-a-given-balance-to-a-given-account."
                class="bd-toc-link"
                style="padding-left: 24px;;"
              >
                <code>deal</code> - Set a given balance to a given account.
              </a></div><div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#etch---sets-the-code-of-an-account."
                class="bd-toc-link"
                style="padding-left: 24px;;"
              >
                <code>etch</code> - Sets the code of an account.
              </a></div><div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#warp---sets-the-block-timestamp."
                class="bd-toc-link"
                style="padding-left: 24px;;"
              >
                <code>warp</code> - Sets the block timestamp.
              </a></div><div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#roll---sets-the-block-number."
                class="bd-toc-link"
                style="padding-left: 24px;;"
              >
                <code>roll</code> - Sets the block number.
              </a></div><div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#fee---sets-the-block-base-fee."
                class="bd-toc-link"
                style="padding-left: 24px;;"
              >
                <code>fee</code> - Sets the block base fee.
              </a></div><div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#chainid---sets-the-chain-id."
                class="bd-toc-link"
                style="padding-left: 24px;;"
              >
                <code>chainId</code> - Sets the chain ID.
              </a></div><div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#coinbase---sets-the-block-coinbase."
                class="bd-toc-link"
                style="padding-left: 24px;;"
              >
                <code>coinbase</code> - Sets the block coinbase.
              </a></div><div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#label---sets-a-label-for-a-given-address."
                class="bd-toc-link"
                style="padding-left: 24px;;"
              >
                <code>label</code> - Sets a label for a given address.
              </a></div><div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#getnonce---gets-the-nonce-of-the-given-account."
                class="bd-toc-link"
                style="padding-left: 24px;;"
              >
                <code>getNonce</code> - Gets the nonce of the given account.
              </a></div><div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#setnonce---sets-the-nonce-of-the-given-account."
                class="bd-toc-link"
                style="padding-left: 24px;;"
              >
                <code>setNonce</code> - Sets the nonce of the given account.
              </a></div><div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#addr---computes-the-address-for-a-given-private-key."
                class="bd-toc-link"
                style="padding-left: 24px;;"
              >
                <code>addr</code> - Computes the address for a given private key.
              </a></div><div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#load---loads-a-storage-slot-from-an-address."
                class="bd-toc-link"
                style="padding-left: 24px;;"
              >
                <code>load</code> - Loads a storage slot from an address.
              </a></div><div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#store---stores-a-value-to-an-address'-storage-slot."
                class="bd-toc-link"
                style="padding-left: 24px;;"
              >
                <code>store</code> - Stores a value to an address' storage slot.
              </a></div><div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#symbolicstorage---makes-the-storage-of-the-given-address-completely-symbolic."
                class="bd-toc-link"
                style="padding-left: 24px;;"
              >
                <code>symbolicStorage</code> - Makes the storage of the given address completely symbolic.
              </a></div>
            </div>
          </details>
        
            </div>
          </details>
        <div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#expecting-the-next-call-to-revert"
                class="bd-toc-link"
                style="padding-left: 8px;;"
              >
                Expecting the next call to revert
              </a></div><div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#expecting-a-specific-call%2Fcreate-opcode"
                class="bd-toc-link"
                style="padding-left: 8px;;"
              >
                Expecting a specific CALL/CREATE opcode
              </a></div><div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#pranks"
                class="bd-toc-link"
                style="padding-left: 8px;;"
              >
                Pranks
              </a></div><div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#expecting-events"
                class="bd-toc-link"
                style="padding-left: 8px;;"
              >
                Expecting Events
              </a></div><div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#restricting-the-accounts-that-can-be-called-in-kevm"
                class="bd-toc-link"
                style="padding-left: 8px;;"
              >
                Restricting the accounts that can be called in KEVM
              </a></div><div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#utils"
                class="bd-toc-link"
                style="padding-left: 8px;;"
              >
                Utils
              </a></div>
            </div>
          </details>
        
</div>

        </div>
        <div class="btn btn-rv-blue page-toc-toggle-btn"></div>
        <!-- End Page ToC -->
      </div>
    </div>
<!-- The footer is now controlled by the k-web-theme git submodule -->
<footer id="rvsite-footer" class="app-footer text-md-left text-center">
  <div class="container">
    <div class="row align-items-center">
      <div class="col-md-4 mb-md-0 mb-4">
        <a href="https://runtimeverification.com/" target="_blank">
          <picture>
            <source
              srcset="
                https://runtimeverification.com/assets/img/rv-logo-dark.png
              "
              media="(prefers-color-scheme: dark)"
            />
            <img
              class="logo-dark"
              src="https://runtimeverification.com/assets/img/rv-logo.png"
              alt="Runtime Verification logo"
              style="height: 32px"
            /> </picture
        ></a>
        <p class="mt-2 text-md-left copyright">
          <a href="https://goo.gl/maps/hKLtCjeEd6yqfzwx5" target="_blank"
            >1807 S Neil Street, Champaign, IL 61820</a
          >
        </p>
      </div>
      <div class="col-md-4 text-md-center mb-md-0 mb-4"></div>
      <div class="col-md-4 mb-md-0 mb-4 pl-0 text-md-right">
        <p class="copyright">2023 © all rights reserved</p>
        <span class="copyright"><a href="https://runtimeverification.com/privacy-policy">privacy policy</a> | <a
                href="https://runtimeverification.com/terms-of-use">terms of use</a></span>
      </div>
    </div>
  </div>
</footer>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/Typist/1.2/typist.min.js"></script>
    <script src="../../../assets/js/index.js"></script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script
  async
  src="https://www.googletagmanager.com/gtag/js?id=G-QL0D8HRYFW"
></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag() {
    dataLayer.push(arguments);
  }
  gtag("js", new Date());
  gtag("config", "G-QL0D8HRYFW");
</script>

  </body>
</html>
